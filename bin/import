#!/bin/bash

#
# Bash script to kick off the ApparelRow Product Importer with the correct
# environment.
#
# Usage:
#   bin/import
# - or -
#   bin/import name-of-feed-vendor
#
# Feeds from all configured FeedVendors will be imported, unless a name is specified
# as sole argument.
#

if [[ -z $PROJDIR ]]; then
    PROJDIR="`dirname $0`/.."
fi

if [[ -e $PROJDIR/bin/activate ]]; then
    . $PROJDIR/bin/activate
fi

cd "$PROJDIR/releases/current/apparelrow"

# Refresh fx rates
$PROJDIR/bin/python manage.py arfxrates --refresh --no_update

if [[ -z "$1" ]]; then
    $PROJDIR/bin/python manage.py arimport --all
elif [ "$1" = "--parallel" ]; then
    $PROJDIR/bin/python manage.py arimport --list | tail -n +2 | cut -d\  -f1 | parallel -j 4 $PROJDIR/bin/python manage.py arimport
else
    $PROJDIR/bin/python manage.py arimport $1
fi

# Update fx rates
$PROJDIR/bin/python manage.py arfxrates --refresh

# Update new products for brands
$PROJDIR/bin/python manage.py brand_updates
