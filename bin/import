#!/bin/bash

#
# Bash script to kick off the ApparelRow Product Importer with the correct
# environment.
#
# Usage:
#   bin/import
# - or -
#   bin/import name-of-feed-vendor
#
# Feeds from all configured FeedVendors will be imported, unless a name is specified
# as sole argument.
#

if [[ -z $DJANGO_SETTINGS_MODULE ]]; then
    DJANGO_SETTINGS_MODULE=production
fi

if [[ -z $PROJDIR ]]; then
    PROJDIR="`dirname $0`/.."
fi

if [[ -e $PROJDIR/bin/activate ]]; then
    . $PROJDIR/bin/activate
fi

cd "$PROJDIR/releases/current/apparelrow"

# Refresh fx rates
$PROJDIR/bin/python manage.py arfxrates --refresh --no_update --settings $DJANGO_SETTINGS_MODULE

if [[ -z "$1" ]]; then
    $PROJDIR/bin/python manage.py arimport --all --settings $DJANGO_SETTINGS_MODULE
else
    $PROJDIR/bin/python manage.py arimport $1 --settings $DJANGO_SETTINGS_MODULE
fi

# Update fx rates
$PROJDIR/bin/python manage.py arfxrates --refresh --settings $DJANGO_SETTINGS_MODULE

