{% extends 'profile/base.html' %}
{% load i18n %}
{% load humanize %}
{% load voting_tags %}
{% load trackback_tags %}
{% load tagging_tags %}

{% block 'extra-styles' %}
    <link rel="pingback" href="{% get_pingback_url %}" />
    {% get_trackback_rdf_for object %}
    <style type="text/css">
        .collage {
            position: relative;
            height: 450px;
            overflow: hidden;
        }
        .tooltip {
            display: none;
            z-index: 1100;
            padding: 1em;
        }
    </style>
{% endblock 'extra-styles' %}

{% block 'extra-scripts' %}
<script type="text/javascript">
    jQuery(document).ready(function() {
        jQuery('.collage .product').tooltip({
            effect: 'slide',
            relative: true,
            delay: 500,
            offset: [30, 0],
        });
       if(jQuery('#comments-and-links textarea').val() == '') { jQuery('#comments-and-links button').hide() }
       jQuery('#comments-and-links textarea').focus(function() { jQuery('#comments-and-links button').show() });
       jQuery('#comments-and-links textarea').blur(function() { if(jQuery(this).val() == '' ) { jQuery('#comments-and-links button').hide() } });
//            jQuery('#comments textarea').autogrow();
        jQuery('#comments-and-links form').submit(function() {
            jQuery.ajax({
                type: this.method,
                url: this.action,
                data: jQuery(this).serialize(),
                dataType: 'json',
                success: function(data, statusText, req) {
                    jQuery('#comments-and-links textarea').val('');
                    jQuery('#comments-and-links button').hide();
                    jQuery('ul#comments').append(data.html).slideDown('fast');
                },
            });
            return false;
        });
    });
</script>
{% endblock 'extra-scripts' %}

{% block body-classes %}look two-columns{% endblock %}

{% block body %}
<div class="sidebar">
    <h2>Sidebar</h2>
    <p>
    {% blocktrans count object.look_products.all|length as number %}
    {{ number }} article
    {% plural %}
    {{ number }} articles
    {% endblocktrans %}
    {{ object.total_price }} SEK
    </p>
    {% if object.description %}<p>{{ object.description }}</p>{% endif %}
    <p>{% trans "Created" %} {{ object.created|naturalday:"Y-m-d" }}</p>
    <p>{% include 'apparel/fragments/likes.html' %}</p>
    {% if looks_by_user %}
    <h2>{% trans "More looks by" %} {{ object.user.get_profile.display_name }}</h2>
    {% with looks_by_user as looks %}
    {% include 'apparel/fragments/looks.html' %}
    {% endwith %}
    {% endif %}
    {% if similar_looks %}
    <h2>{% trans "Similar looks" %}</h2>
    {% with similar_looks as looks %}
    {% include 'apparel/fragments/looks.html' %}
    {% endwith %}
    {% endif %}
</div>
<div id="content">
    <h2>{{ object.title }}</h2>
    <div class="collage">
        {% include 'apparel/fragments/look_collage.html' %}
        <form method="post" action="{% url like-look object.slug "up" %}">
            <button type="submit" name="like" id="like">{% trans "Like" %}</button>
        </form>
    </div>
    {% ifequal object.user user %}
    <a href="{% url apparel.views.look_edit object.id %}">{% trans "Edit look" %}</a>
    {% endifequal %}
    {% get_trackbacks_for object as trackbacks %}
    {% include 'apparel/fragments/comments.html' %}
    {% tags_for_object object as tags %}
    {% if tags %}
    <div id="tags">
        <h2>{% trans "Tags" %}</h2>
        <ul>
            {% for tag in tags %}
            {% tagged_objects tag in apparel.look as looks_with_tag %}
            <li>{{ tag.name }}<span>{{ looks_with_tag|length }}</span></li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    {% comment %}
    <h2>{% trans "Articles in this look" %}</h2>
    <div id="lookproducts">
        {% with object.products.all as products %}
        {% include 'apparel/fragments/product_row.html' %}
        {% endwith %}
    </div>
    {% endcomment %}
</div>
{% endblock body %}
