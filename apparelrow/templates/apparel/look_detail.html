{% extends 'base.html' %}
{% load i18n humanize trackback_tags tagging_tags comments cache apparel_extras %}

{% block extra-title %}{{ object.title }} {% trans "by" %} {{ object.user.get_profile.display_name }} | {% trans "Looks" %} | {% endblock %}

{% block head-data %} prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# {{ FACEBOOK_OG_TYPE }}: http://ogp.me/ns/fb/{{ FACEBOOK_OG_TYPE }}#"{% endblock head-data %}

{% block extra-styles %}
    <link rel="pingback" href="{% get_pingback_url %}" />
    {% get_trackback_rdf_for object %}
    <meta property="og:title" content="{{ object }}"/>
    <meta property="og:type" content="{{ FACEBOOK_OG_TYPE }}:look"/>
    <meta property="og:image" content="{{ look_full_image }}"/>
    <meta property="og:url" content="{{ object_url }}"/>
    <meta property="og:description" content="{{ object.description }}"/>
    <meta property="og:site_name" content="{{ CURRENT_NAME }}"/>
    <meta property="fb:app_id" content="{{ FACEBOOK_APP_ID }}"/>
{% endblock extra-styles %}

{% block 'extra-scripts' %}
<script type="text/javascript">
    jQuery(document).ready(function() {
        makeProductTooltip('.collage .product, .photo .product');
        jQuery('#embed-code, #url-code')
            .focus(function(e) { this.select(); })
            .mouseup(function(e) { e.preventDefault() });

        jQuery('#look-header .delete').click(function(event) {
            var title = jQuery(this).attr('title');
            var href = jQuery(this).attr('href');
            create_modal_dialog(
                '{% trans "Are you sure?" %}',
                ['{% trans "Do you really want to delete look" %} <span class="bold">' + title + '</span>?'],
                function (modal_dialog) { location.href = href; },
                function (modal_dialog) { modal_dialog.close(); }
            );
            event.preventDefault();
        });

        {% if look_saved %}
        ApparelActivity.notification('create', 'look', {{ object.id }});
        {% endif %}
    });

</script>
{% endblock 'extra-scripts' %}

{% block body-classes %}look two-columns{% endblock %}

{% block body %}
<div id="look-header">
    <a href="{{ object.user.get_profile.get_absolute_url }}"><img src="{{ object.user.get_profile.avatar }}" class="profile-image" /></a>
    <div class="look-header-content">
        <h1>{{ object.title }}</h1>
        {% if object.user == request.user %}
            <a class="edit" href="{% url apparel.views.look_edit object.slug %}">{% trans "Edit" %}</a>
            <a class="delete" title="{{ object.title }}" href="{% url apparel.views.look_delete object.slug %}">{% trans "Delete" %}</a>
        {% endif %}
        <div class="look-user-url">
            {% url profile.views.looks object.user.get_profile.slug as looks_url %}
            <a href="{{ looks_url }}">{% blocktrans with object.user.get_profile.display_name as name %}{{name}}'s looks{% endblocktrans %}</a>
        </div>
    </div>
</div>

<div class="sidebar">
    {% if object.user != request.user %}
        {% with object.user.get_profile as profile %}
        <p class="large_follow">{% include 'apparel/fragments/follow.html' %}</p>
        {% endwith %}
    {% endif %}
{% cache CACHE_TIMEOUT look_detail1 object.id LANGUAGE_CODE %}
    {% include 'apparel/fragments/total_price.html' %}
    {% if object.description %}
        <p class="description">{{ object.description }}</p>
    {% endif %}
    <div class="share-created">
        <span class="created">{% trans "Created" %} {{ object.created|naturalday:"Y-m-d" }}</span>
    </div>
{% endcache %}
    {% get_comment_count for object as comment_count %}
    <div class="activity">
    {% include 'apparel/fragments/comment_count.html' %}
      {% url apparel.views.look_user_like_list object.slug as likes_url %}
      <p class="last">{% include 'apparel/fragments/likes_link.html' %}</p>
    </div>
{% cache CACHE_TIMEOUT look_detail2 object.id LANGUAGE_CODE %}
    <div class="spread">
        <div class="first">
            <label>{% trans "Embed this look on your blog or site" %}:<input type="text" value="{% filter force_escape %}{% include 'apparel/fragments/look_widget.html' %}{% endfilter %}" id="embed-code"></label>
        </div>
        <div class="last">
            <label>{% trans "Direct link to this page" %}:<input type="text" value="{% filter force_escape %}{{ object_url }}{% endfilter %}" id="url-code"></label>
        </div>
    </div>
    {% if looks_by_user %}
    <a href="{{ looks_url }}"><h2>{% trans "More looks by" %} {{ object.user.get_profile.display_name }}</h2></a>
    {% with looks_by_user as looks %}
    {% include 'apparel/fragments/looks.html' %}
    {% endwith %}
    {% endif %}
    {% if similar_looks %}
    <h2>{% trans "Similar looks" %}</h2>
    {% with similar_looks as looks %}
    {% include 'apparel/fragments/looks.html' %}
    {% endwith %}
    {% endif %}
</div>
<div id="content">
    {# FIXME: Add a "display_as "whatever" or "dispay_as_whatever" property to thge look object rather than checking the flag #}
    {% if object.display_with_component == 'C' %}
        <div class="collage">
        {% include 'apparel/fragments/look_collage.html' %}
        </div>
    {% else %}
        <div class="photo">
        {% include 'apparel/fragments/look_photo.html' %}
        </div>
    {% endif %}
{% endcache %}
    <a class="look-like heart{% if user|likes_look:object %} liked{% endif %}" href="#" data-dialog-url="{% url dialog-like-look %}" data-like-url="{% url apparel.views.look_like object.slug 'like' %}" data-unlike-url="{% url apparel.views.look_like object.slug 'unlike' %}" data-slug="{{ object.slug }}" data-id="{{ object.id }}"></a>
    {% get_trackbacks_for object as trackbacks %}
    {% include 'apparel/fragments/comments.html' %}
{% cache CACHE_TIMEOUT look_detail3 object.id LANGUAGE_CODE %}
    {% tags_for_object object as tags %}
    {% if tags %}
    <div id="tags">
        <h2>{% trans "Tags" %}</h2>
        <ul>
            {% for tag in tags %}
            {% tagged_objects tag in apparel.look as looks_with_tag %}
            <li>{{ tag.name }}<span>{{ looks_with_tag|length }}</span></li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>
{% endcache %}
<div id="look-tooltips">
    {% for component in object.display_components.all %}
        {% cache CACHE_TIMEOUT look_product_tooltip component.product.id LANGUAGE_CODE %}
        {% include "apparel/fragments/look_product_tooltip.html" with product=component.product only %}
        {% endcache %}
    {% endfor %}
</div>
{% endblock body %}
