{% extends 'base.html' %}
{% load static from staticfiles %}
{% load i18n compressed %}

{% block extra-title %}{% trans "Edit" %} {{ object.title }} {% trans "by" %} {{ object.user }} | {% trans "Looks" %} | {% endblock %}

{% block header %}

    <div id="header" class="small">
        <div id="inner-header">
            {% include 'apparel/shared_header.html' %}
        </div>
    </div>

{% endblock %}

{% block body-classes %}look-editor{% endblock %}
{% block body %}

    <div id="content" class="group">

        <div class="body-header">
          <h1>{% if object %}{{ object.title }} {% if not object.published %}({% trans "Draft" %}) {% endif %}<span>{% trans "by" %} {{ object.user.display_name }}</span>{% else %}{% if component == 'photo' %}{% trans "Create a tagged photo" %}{% else %}{% trans "Create a collage" %}{% endif %}{% endif %}</h1>
            <div class="button-container">
                {% if object and object.slug %}
                <button class="btn btn-upper btn-delete btn-negative" name="look_delete">{% trans "Delete look" %}</button>
                {% else %}
                <button class="btn btn-upper btn-reset" name="look_reset">{% trans "Reset look" %}</button>
                {% endif %}
                <button class="btn btn-upper btn-save" name="look_save">{% if object and object.published %}{% trans "Save" %}{% else %}{% trans "Save draft" %}{% endif %}</button>
                {% if object and object.published %}
                <button class="btn btn-upper btn-positive btn-unpublish" name="look_publish" data-publish-text="{% trans "Publish" %}" data-unpublish-text="{% trans "Unpublish" %}">{% trans "Unpublish" %}</button>
                {% else %}
                <button class="btn btn-upper btn-positive btn-publish" name="look_publish" data-publish-text="{% trans "Publish" %}" data-unpublish-text="{% trans "Unpublish" %}">{% trans "Publish" %}</button>
                {% endif %}
            </div>
        </div>

        <div id="edit-look"></div>

        <div id="product-chooser">
            <ul id="product-tabs" class="group">
                <li class="first"><a class="tab-likes{% if request.user.is_authenticated and has_liked %} selected{% endif%}"{% if request.user.is_authenticated %} data-user="{{ request.user.id }}"{% endif %} href="#likes">{% trans "Your â™¥" %}</a>
                <li class="last"><a class="tab-all{% if not request.user.is_authenticated or not has_liked %} selected{% endif%}" href="#all">{% trans "All products" %}</a></li>
            </ul>
            <div class="product-filter-container">
                <div id="product-filter" class="group">
                    <div class="middle-filters group">
                        <input id="product-search" type="search" name="q" placeholder="{% trans "Search for your product here..." %}">
                        <ul id="product-gender">
                            <li><a href="#" data-value="W"{% if APPAREL_GENDER == 'W' %} class="selected"{% endif %}>{% trans "Women" %}</a></li>
                            <li><a href="#" data-value="M"{% if APPAREL_GENDER == 'M' %} class="selected"{% endif %}>{% trans "Men" %}</a></li>
                        </ul>
                        <a class="btn btn-upper btn-product-reset" style="display:none;" href="#">{% trans "Reset" %}</a>
                    </div>
                    <div class="hidden-filters-container">
                        <ul class="hidden-filters">
                            <li id="product-filter-category" class="dropdown left">
                                <a href="#" data-default-name="{% trans "Choose category" %}"><span>{% trans "Choose category" %}</span></a>
                            </li>
                            <li id="product-filter-subcategory" class="dropdown left">
                                <a href="#" data-default-name="{% trans "Subcategory" %}"><span>{% trans "Subcategory" %}</span></a>
                            </li>
                            <li id="product-filter-color" class="dropdown">
                                <a href="#" data-default-name="{% trans "Color" %}"><span>{% trans "Color" %}</span></a>
                            </li>
                            <li id="product-filter-price" class="dropdown">
                                <a href="#" data-default-name="{% trans "Price" %}"><span>{% trans "Price" %}</span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="product-list-container">
                <div id="product-list-empty">
                    <p>{% trans "No matching items" %}</p>
                    <a class="btn btn-upper btn-reset" href="#">{% trans "Reset search" %}</a>
                </div>
                <div id="product-list-unauthenticated">
                    <p>{% trans "Connect with your Facebook account to save your favourite items" %}</p>
                    <a class="facebook-btn" href="#login"><img src="{% static "images/facebook-en.png" %}"></a>
                </div>
                <ul id="product-list"></ul>
            </div>
        </div>
    </div>

    <script type="text/template" id="dialog_login_template">
        <p>{% trans "Do you want to save this look before logging in with Facebook?" %}</p>
        <a href="#" class="btn btn-upper btn-block btn-cancel">{% trans "Cancel" %}</a>
        <a href="#" class="btn btn-upper btn-block btn-no">{% trans "No" %}</a>
        <a href="#" class="btn btn-upper btn-block btn-positive btn-yes">{% trans "Yes" %}</a>
    </script>

    <script type="text/template" id="dialog_reset_template">
        <p>{% trans "Are you sure you want to discard changes and start over?" %}</p>
        <a href="#" class="btn btn-upper btn-block btn-no">{% trans "No" %}</a>
        <a href="#" class="btn btn-upper btn-block btn-positive btn-yes">{% trans "Yes" %}</a>
    </script>

    <script type="text/template" id="dialog_delete_template">
        <p>{% trans "Are you sure you want to permanently delete your look?" %}</p>
        <a href="#" class="btn btn-upper btn-block btn-no">{% trans "No" %}</a>
        <a href="#" class="btn btn-upper btn-block btn-positive btn-yes">{% trans "Yes" %}</a>
    </script>

    <script type="text/template" id="dialog_unpublish_template">
        <p>{% trans "Are you sure you want to unpublish this look so that no one can see it?" %}</p>
        <a href="#" class="btn btn-upper btn-block btn-no">{% trans "No" %}</a>
        <a href="#" class="btn btn-upper btn-block btn-positive btn-yes">{% trans "Yes" %}</a>
    </script>

    <script type="text/template" id="dialog_save_template">
        <label for="look_title">{% trans "Your look title" %} *</label>
        <input id="look_title" type="text" value="<%= title %>" name="title">

        <label for="look_description">{% trans "Description" %}</label>
        <textarea name="description" id="look_description"><%= description %></textarea>

        <a href="#" class="btn btn-upper btn-block btn-cancel">{% trans "Cancel" %}</a>
        <a href="#" class="btn btn-upper btn-block btn-positive btn-save"><% if(published) { %>{% trans "Save" %}<% } else { %>{% trans "Save draft" %}<% } %></a>
    </script>

    <script type="text/template" id="dialog_publish_template">
        <label for="look_title">{% trans "Your look title" %} *</label>
        <input id="look_title" type="text" value="<%= title %>" name="title">

        <label for="look_description">{% trans "Description" %}</label>
        <textarea name="description" id="look_description"><%= description %></textarea>

        <a href="#" class="btn btn-upper btn-block btn-cancel">{% trans "Cancel" %}</a>
        <a href="#" class="btn btn-upper btn-block btn-positive btn-publish">{% trans "Publish" %}</a>
    </script>

    <script type="text/template" id="popup_slim_template">
        <div class="header group">
            <h5 class="title"></h5>
            <a href="#" class="close"></a>
        </div>
        <div class="content-container">
            <div class="content"></div>
        </div>
    </script>

    <script type="text/template" id="look_edit_popup_loading">
        <img class="loading" src="{% static "images/loading_white.gif" %}">
    </script>

    <script type="text/template" id="look_edit_add_popup_template">
        <div class="add-container group">
            <img src="{% static "images/big-larrow.png" %}">
            <p>{% trans "Click in photo to place item" %}</p>
            <img src="<%= image_small %>">
        </div>
    </script>

    <script type="text/template" id="edit_look_template">
        <div class="look-container" id="<%= look_type %>"<% if(look_type == 'photo' && look.image) { %> style="background-image: url('<%= look.image %>');"<% } %>></div>
    </script>

    <script type="text/template" id="look_component_photo">
        <a href="#" class="delete"></a>
    </script>

    <script type="text/template" id="look_component_collage">
        <img src="<%= product.image_medium %>" style="width: 100%; height: 100%;">
        <a href="#" class="delete"></a>
    </script>

    <script type="text/template" id="temporary_image_form_template">
        <div class="loading" style="display:none;">
            <span>{% trans "Uploading image" %}</span> <img src="{% static "images/loading_white.gif" %}">
        </div>
        <form enctype="multipart/form-data" action="{% url 'temporary-image' %}" method="POST" id="temporaryimage">
            {% csrf_token %}
            <div class="look-empty">
                <p>{% trans "Start by uploading a photo" %}</p>
                <div class="upload-field">
                    <span><input type="file" name="image_file"></span>
                </div>
                <button type="submit">{% trans "Upload" %}</button>
            </div>
        </form>
    </script>

    <script type="text/template" id="product_small_template">
        <div class="product-small product-container">
            <a class="image-small" href="#">
                <img src="<%= image_small %>">
            </a>
            <div class="hover">
                <a class="btn btn-upper btn-block btn-info" href="#">{% trans "Info" %}</a>
                <a class="btn btn-upper btn-block btn-positive btn-add" href="#">{% trans "Add" %}</a>
            </div>
            <div class="caption">
                <h4><%= brand_name %></h4>
                <% if(!availability) { %>
                <span class="sold-out">SOLD OUT</span>
                <% } else { %>
                <p>
                    <% if(discount) { %>
                        <span class="discount-price"><%= formatNumber(discount_price) %> <%= currency %></span>
                        <span class="price discounted"><%= formatNumber(price) %> <%= currency %></span>
                    <% } else { %>
                        <span class="price"><%= formatNumber(price) %> <%= currency %></span>
                    <% } %>
                </p>
                <% } %>
            </div>
        </div>
    </script>

    <script type="text/javascript">
        var external_look_type = '{{ component }}';
        var external_look_id = {% if object %}{{ object.id }}{% else %}-1{% endif %};
        var external_has_liked = '{{ has_liked }}';
    </script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
    {% compressed_js 'look_editor' %}

{% endblock body %}

{% block pinterest-scripts %}{% endblock %}
