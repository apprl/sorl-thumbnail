{% extends 'base.html' %}
{% load i18n cache thumbnail apparel_extras %}

{% block extra-title %}{% if APPAREL_GENDER == 'M' %}{% trans "Looks Men" %}{% else %}{% trans "Looks Women" %}{% endif %} | {% endblock %}
{% block 'extra-scripts' %}
<script type="text/javascript">
    jQuery(document).ready(function() {
        makeProductTooltip('.collage .product, .photo .product');
    });
</script>
{% endblock 'extra-scripts' %}

{% block body-classes %}one-column look-list{% endblock body-classes %}
{% block body %}
    <div id="content">
        {% url look-list-men as look_list_men %}
        {% url look-list-women as look_list_women %}
        {% url popular-look-list as popular_look_list_url %}
        {% if request.path == look_list_women or request.path == look_list_men or request.path == popular_look_list_url %}
        <ul class="look-list-tabs">
            <li><a class="first latest{% if 'popular' not in request.path %} current{% endif %}" href="{% gender_url APPAREL_GENDER 'look-list' %}">{% trans "Popular looks" %}</a></li>
            <li><a class="last popular{% if 'popular' in request.path %} current{% endif %}" href="{{ popular_look_list_url }}">{% trans "Popular looks in your network" %}</a></li>
        </ul>
        {% else %}
            {% if 'products/' in request.path %}
            <h2>{% trans "Showing" %} {% blocktrans count paginator.count as counter %}{{ counter }} look{% plural %}{{ counter }} looks{% endblocktrans %}</h2>
            {% else %}
            <h2>{% trans "Showing" %} '{{ query|escape }}', {% blocktrans count paginator.count as counter %}{{ counter }} look{% plural %}{{ counter }} looks{% endblocktrans %}</h2>
            {% endif %}
        {% endif %}

        {% if not user.is_authenticated and request.path == popular_look_list_url %}
            <div>{% trans "To see popular looks in your network you need to connect with your Facebook account." %}</div>
            {% with MEDIA_URL|add:'images/facebook-'|add:LANGUAGE_CODE|add:'.png' as facebook_login_image %}
                {% facebook_button facebook_login_image %}
            {% endwith %}
        {% else %}
            {% if not current_page.object_list and request.path == popular_look_list_url %}
                <div>{% trans "You currently don't follow anyone who has liked any looks, find friends to follow amoung our members." %}</div>
                <a class="all-users" href="{% url apparel.views.user_list %}">{% trans "See all members" %}</a>
            {% else %}
                <ul class="looks">
                {% for object in current_page.object_list %}
                    <li{% cycle '' ' class="last"' %}>

                        {% cache CACHE_TIMEOUT look_list object.id LANGUAGE_CODE %}
                        <div class="look-medium {% if object.display_with_component == 'P' %}photo{% else %}collage{% endif %}">
                            {% if object.display_with_component == 'P' %}
                                <div id="photo-background" class="look-photo"
                                    {% if object.image %}
                                    {% thumbnail object.image "450x334" as im %}
                                    style="background-image: url('{{ im.url }}'); width: {{ im.width }}px; height: {{ im.height }}px"
                                    {% endthumbnail %}
                                    {% endif %}
                                >
                                {% for component in object.photo_components.all %}
                                    <a href="{{ component.product.get_absolute_url }}" class="hotspot product" id="hotspot-{{ component.product.id }}" style="{{ component.style_middle }}"></a>
                                {% endfor %}
                                <a class="look-like look-heart{% if user|likes_look:object %} liked{% endif %}" href="#" data-like-url="{% url apparel.views.look_like object.slug 'like' %}" data-unlike-url="{% url apparel.views.look_like object.slug 'unlike' %}" data-slug="{{ object.slug }}"></a>
                                </div>
                            {% else %}
                                {% for component in object.collage_components.all %}
                                    {% thumbnail component.product.product_image "450x334" crop="noop" format="PNG" transparent=True as im %}
                                    <a href="{{ component.product.get_absolute_url }}">
                                        <img id="product-{{ component.product.id }}" class="product collage-image" style="{{ component.style_middle }}" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" />
                                    </a>
                                    {% endthumbnail %}
                                {% endfor %}
                                <a class="look-like look-heart{% if user|likes_look:object %} liked{% endif %}" href="#" data-like-url="{% url apparel.views.look_like object.slug 'like' %}" data-unlike-url="{% url apparel.views.look_like object.slug 'unlike' %}" data-slug="{{ object.slug }}"></a>
                            {% endif %}
                        </div>
                        <h3><a href="{{ object.get_absolute_url }}">{{ object.title }}</a></h3>
                        <p>{% trans "By" %} <a href="{{ object.user.get_absolute_url }}">{{ object.user.get_profile.display_name }}</a></p>
                        <div class="stats">
                            <div class="likes">{{ object.score }}</div>
                            {% if object.comment_count > 0 %}
                            <div class="comments">{{ object.comment_count }}</div>
                            {% endif %}
                        </div>
                        {% endcache %}
                        <div id="look-tooltips">
                            {% for component in object.display_components.all %}
                                {% cache CACHE_TIMEOUT look_product_tooltip component.product_id LANGUAGE_CODE %}
                                {% include "apparel/fragments/look_product_tooltip.html" with product=component.product only %}
                                {% endcache %}
                            {% endfor %}
                        </div>

                    </li>
                {% endfor %}
                </ul>
                <div class="pagination">
                    {% include 'apparel/fragments/pagination.html' %}
                </div>
            {% endif %}
        {% endif %}
    </div>
{% endblock body %}
