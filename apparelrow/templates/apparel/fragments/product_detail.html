{% load i18n %}
{% load humanize %}
{% load comments %}
{% load apparel_extras %}
{% load cache %}
{% if object and object.product_image %}
{% cache CACHE_TIMEOUT product_detail_fragment1 object.id LANGUAGE_CODE %}
<div class="product-left">
    <div class="product-image">
        <a href="{{ object.product_image.url }}" title="{{ object.manufacturer }} - {{ object.product_name }}"><img src="/scale/328x500{{ object.product_image.url }}" /></a>
{% endcache %}
        {% url apparel.views.product_like object.slug 'like' as like_url %}
        {% url apparel.views.product_like object.slug 'unlike' as unlike_url %}
        {% url dialog-like-product as dialog_url %}
        {% with user|likes_product:object as is_liked %}
        {% include 'apparel/fragments/like_button.html' %}
        {% endwith %}
    </div>
    {% include 'apparel/fragments/comments.html' %}
{% cache CACHE_TIMEOUT product_detail_fragment2 object.id LANGUAGE_CODE %}
</div>
<div class="product-info">
    <h2>
    {% for category in object.categories %}
    {% if forloop.first %}
    <a href="{% url apparel.browse.browse_products %}#category={{ category.id }}">{{ category }}</a>
    {% else %}
    \ <a href="{% url apparel.browse.browse_products %}#category={{ category.id }}">{{ category }}</a>
    {% endif %}
    {% endfor %} \ {{ object.manufacturer }}
    </h2>
    <h1>{{ object.manufacturer }}</h1>
    {% if object.product_name %}<h3>{{ object.product_name }}</h3>{% endif %}
    {% regroup object.options.all by option_type as option_list %}
    <!-- FIXME: Style this properly. See ticket #300 
    <ul class="product-options">
    {% for option in option_list %}
        <li>{{ option.grouper }}
        <ul class="option-{{ option.grouper|slugify }} clearfix">
            {% for item in option.list %}
            <li class="{{ item.value|slugify }}">{{ item.value }}</li>
            {% endfor %}
        </ul>
        </li>
    {% endfor %}
    </ul>
    -->
    <p class="description">{{ object.description }}</p>
    <div class="product-vendors">
        {% with object.vendorproduct.all|dictsort:'price' as vendorproducts %}
        {% for vendorproduct in vendorproducts %}
            {% if forloop.first %}
                {% if vendorproduct.availability == 0 %}
                <span class="sold-out{% if vendorproduct.currency != vendorproduct.original_currency %} higher{% endif %}">{% trans "Sold out" %}</span>
                {% else %}
                <a href="{% url apparelrow.statistics.views.product_click_count %}?i={{ object.id }}&u={{ vendorproduct.buy_url|urlencode }}" target="_new" class="buy-now{% if vendorproduct.currency != vendorproduct.original_currency %} higher{% endif %}">{% trans "Buy" %}</a>
                {% endif %}
            {% endif %}
            <div class="product-vendor">
                <span class="price">{{ vendorproduct.price }}</span><span class="currency">{{ vendorproduct.currency }}</span>
                {% if vendorproduct.availability == 0 %}
                <a class="vendor" target="_new" href="{{ vendorproduct.vendor.homepage }}">{{ vendorproduct.vendor }}</a>
                {% else %}
                <a class="vendor" target="_new" href="{% url apparelrow.statistics.views.product_click_count %}?i={{ object.id }}&u={{ vendorproduct.buy_url|urlencode }}">{{ vendorproduct.vendor }}</a>
                {% endif %}
                {% if vendorproduct.currency != vendorproduct.original_currency %}
                <div class="original-price">
                    <span class="price">{{ vendorproduct.original_price }}</span><span class="currency">{{ vendorproduct.original_currency }}</span>
                </div>
                {% endif %}
            </div>
        {% empty %}
            <span class="sold-out">{% trans "Sold out" %}</span>
            <div class="product-vendor">
                <span class="price"></span><span class="currency"></span>
            </div>
        {% endfor %}
        {% endwith %}
    </div>
{% endcache %}
    <ul id="add-menu" class="menu hover-menu">
        {% include 'apparel/fragments/share.html' %}
        <li id="add-to-look">
            <a href="/apparel/look/">{% trans "Add to look" %}</a>
            <form action="{% url apparel.views.add_to_look %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="look" />
            <input type="hidden" name="product" value="{{ object.id }}" />
            <ul>
            {% for look in user_looks %}
                {% include "apparel/fragments/look_button.html" %}
            {% endfor %}
                <li id="add-to-look-new" class="last">
                    <input type="text" name="new_name" value="{% trans "Enter look name" %}" />
                    <button type="submit" name="new" value="1">{% trans "New look" %}</button>
                </li>
            </ul>
            </form>
        </li>
        <li id="add-to-wardrobe" class="top last">
            {% if is_in_wardrobe %}
                <form class="delete" action="{% url apparel.views.delete_from_wardrobe %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="product" value="{{ object.id }}" />
                    <button type="submit" id="wardrobe-button-delete" title="{% trans "Delete product from my wardrobe" %}">{% trans "In wardrobe" %}</button>
                </form>
            {% else %}
                <form class="add" action="{% url apparel.views.add_to_wardrobe %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="product" value="{{ object.id }}" />
                    <button type="submit" id="wardrobe-button-add" title="{% trans "Add to wardrobe" %}">{% trans "Add to wardrobe" %}</button>
                </form>
            {% endif %}
        </li>
    </ul>
</div>
{% endif %}

