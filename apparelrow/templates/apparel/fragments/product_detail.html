{% load i18n %}
{% load humanize %}
{% load comments %}
{% load apparel_extras %}
{% load cache %}
{% if object and object.product_image %}
{% cache CACHE_TIMEOUT product_detail_fragment1 object.id LANGUAGE_CODE %}
<div class="product-left">
    <div class="product-image">
        <a href="{{ object.product_image.url }}" title="{{ object.product_name }}"><img src="/scale/328x500{{ object.product_image.url }}" /></a>
        <form method="post" class="like" action="{% url like-product object.slug "up" %}">
            <button type="submit" name="like" id="like">{% trans "Like" %}</button>
        </form>
    </div>
{% endcache %}
    {% include 'apparel/fragments/comments.html' %}
{% cache CACHE_TIMEOUT product_detail_fragment2 object.id LANGUAGE_CODE %}
</div>
<div class="product-info">
    <h2>{{ object.categories|join:' \\ ' }} \ {{ object.manufacturer }}</h2>
    <h1>{{ object.product_name }}</h1>
    <h3>{{ object.manufacturer }}</h3>
    {% regroup object.options.all by option_type as option_list %}
    <!-- FIXME: Style this properly. See ticket #300 
    <ul class="product-options">
    {% for option in option_list %}
        <li>{{ option.grouper }}
        <ul class="option-{{ option.grouper|slugify }} clearfix">
            {% for item in option.list %}
            <li class="{{ item.value|slugify }}">{{ item.value }}</li>
            {% endfor %}
        </ul>
        </li>
    {% endfor %}
    </ul>
    -->
    <p class="description">{{ object.description }}</p>
    <div class="product-vendors">
        {% with object.vendorproduct.all|dictsort:'price' as vendorproducts %}
        {% for vendorproduct in vendorproducts %}
            {% if forloop.first %}
            <a href="{{ vendorproduct.buy_url }}" target="_new" class="buy-now{% if vendorproduct.currency != vendorproduct.original_currency %} higher{% endif %}">{% trans "Buy" %}</a>
            {% endif %}
            <div class="product-vendor">
                <span class="price">{{ vendorproduct.price }}</span><span class="currency">{{ vendorproduct.currency }}</span>
                <a class="vendor" href="{{ vendorproduct.buy_url }}">{{ vendorproduct.vendor }}</a>
                {% if vendorproduct.currency != vendorproduct.original_currency %}
                <div class="original-price">
                    <span class="price">{{ vendorproduct.original_price }}</span><span class="currency">{{ vendorproduct.original_currency }}</span>
                </div>
                {% endif %}
            </div>
        {% endfor %}
        {% endwith %}
    </div>
    <ul id="add-menu" class="menu hover-menu">
        {% include 'apparel/fragments/share.html' %}
        <li id="add-to-look">
            <a href="/apparel/look/">{% trans "Add to look" %}</a>
            <form action="{% url apparel.views.add_to_look %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="look" />
            <input type="hidden" name="product" value="{{ object.id }}" />
            <ul>
            {% for look in user_looks %}
                {% include "apparel/fragments/look_button.html" %}
            {% endfor %}
                <li id="add-to-look-new" class="last">
                    <input type="text" name="new_name" value="{% trans "Enter look name" %}" />
                    <button type="submit" name="new" value="1">{% trans "New look" %}</button>
                </li>
            </ul>
            </form>
        </li>
        <li id="add-to-wardrobe" class="top last">
            {% if is_in_wardrobe %}
                <button>{% trans "In wardrobe" %}</button>
            {% else %}
                <form action="{% url apparel.views.add_to_wardrobe %}" method="post">
                    <input type="hidden" name="product" value="{{ object.id }}" />
                    <button type="submit" id="wardobe-button-add">
                        {% trans "Add to wardrobe" %}                
                    </button>
                </form>
            {% endif %}
        </li>
    </ul>
</div>
{% endcache %}
{% endif %}

