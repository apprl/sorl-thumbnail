{% load i18n %}
{% load humanize %}
{% load comments %}
{% if object and object.product_image %}
<div class="product-left">
    <div class="product-image">
        <a href="{{ object.product_image.url }}" title="{{ object.product_name }}"><img src="/scale/328x500/site_media/media/{{ object.product_image }}" /></a>
        <span class="magnifier"></span>
        <form method="post" action="{% url like-product object.slug "up" %}">
            <button type="submit" name="like" id="like">{% trans "Like" %}</button>
        </form>
    </div>
    {% include 'apparel/fragments/comments.html' %}
</div>
<div class="product-info">
    <h2>{{ object.category.all|join:' \\ ' }} \ {{ object.manufacturer }}</h2>
    <h1>{{ object.product_name }}</h1>
    <h3>{% trans "by" %} {{ object.manufacturer }}</h3>
    {% regroup object.options.all by option_type as option_list %}
    <ul class="product-options">
    {% for option in option_list %}
        <li>{{ option.grouper }}
        <ul class="option-{{ option.grouper|slugify }} clearfix">
            {% for item in option.list %}
            <li class="{{ item.value|slugify }}">{{ item.value }}</li>
            {% endfor %}
        </ul>
        </li>
    {% endfor %}
    </ul>
    <p class="description">{{ object.description }}</p>
    <div class="product-vendors">
        {% with object.vendorproduct.all|dictsort:'price' as vendorproducts %}
        {% for vendorproduct in vendorproducts %}
            {% if forloop.first %}
            <a href="{{ vendorproduct.buy_url }}" class="buy-now">{% trans "Buy" %}</a>
            {% endif %}
            <div class="product-vendor">
                <span class="price">{{ vendorproduct.price }}</span><span class="currency">{{ vendorproduct.currency }}</span>
                <a class="vendor" href="{{ vendorproduct.buy_url }}">{{ vendorproduct.vendor }}</a>
            </div>
        {% endfor %}
        {% endwith %}
    </div>
    <ul id="add-menu" class="clearfix">
        <li class="share">
            <a href="#">{% trans "Share" %}</a>
        </li>
        <li id="add-to-look">
            <a href="/apparel/look/">{% trans "Add to look" %}</a>
            <form action="{% url apparel.views.add_to_look %}" method="post">
            <input type="hidden" name="product_id" value="{{ object.id }}" />
            <ul>
            {% for look in looks %}
                <li>
                    <button type="submit" name="{{ look.id }}">{{ look.title }}</button>
                </li>
            {% endfor %}
                <li class="last">
                    <button type="submit">{% trans "New look" %}</button>
                </li>
            </ul>
            </form>
        </li>
        <li id="add-to-wardrobe" class="last">
            <form action="{% url apparel.views.add_to_wardrobe %}" method="post">
                <input type="hidden" name="product_id" value="{{ object.id }}" />
                <!-- FIXME: Use phrase "In wardrobe" if product is already in wardrobe -->
                <button type="submit">{% trans "Add to wardrobe" %}</a></button>
            </form>
        </li>
    </ul>
</div>
{% endif %}
