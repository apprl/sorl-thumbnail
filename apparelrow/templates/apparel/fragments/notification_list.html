    {% load thumbnail apparel_extras staticfiles %}
    {% load tz %}

    <li class="dropdown notifications">
        <a class="dropdown-toggle notification-dropdown" data-toggle="dropdown" data-user="{{ request.user.id }}" href="#">
            <?xml version="1.0" encoding="utf-8" standalone="no"?>
            <svg width="9px" height="16px" viewBox="0 0 9 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g stroke="none" stroke-width="1" fill="none">
            <g fill="#ffffff">
                <path d="M5.56425,5.4157037 L7.61271429,0.231407407 L1.854,0.231407407 L0.297321429,7.78607407 L3.17667857,7.78607407 L1.25228571,15.7685926 L8.70235714,5.4157037 L5.56425,5.4157037 L5.56425,5.4157037 Z"></path>
            </g>
            </g>
            </svg>
            {% if request.user.unread_count > 0 %}<span id="unread_count" class="unread_count badge">{{ request.user.unread_count }}</span>{% endif %}
        </a>

        <ul class="dropdown-menu ncp-notifications notification-list" role="menu" style="width: 400px !important;">
            {% localtime on %}
            {% for event in request.user.notifications %}
                <li>
                    {% if event.type == "LIKELOOK" %}
                        <span class="ncp-image">
                            <a href="{{ event.actor.url_likes }}">
                                <img class="img-circle" src="{{ event.actor.avatar_small }}" alt="{{ event.actor }}" title="{{ event.actor }}" width="32" height="32">
                            </a>
                        </span>
                        <span class="ncp-message">
                            <span class="ncp-placeholder">
                                <p>
                                    <a href="{{ event.actor.url_likes }}"><strong>{{ event.actor }}</strong></a> liked your look
                                    <a href="{{ event.look.get_absolute_url }}">
                                        <strong>{{ event.look.title }}</strong>
                                    </a>
                                </p>
                            </span>
                        </span>
                    {% elif event.type == "FB" %}
                        <span class="ncp-image">
                            <a href="{{ event.actor.url_likes }}">
                                <img class="img-circle" src="{{ event.actor.avatar_small }}" alt="{{ event.actor }}" title="{{ event.actor }}" width="32" height="32"/>
                            </a>
                        </span>
                        <span class="ncp-message">
                            <span class="ncp-placeholder">
                                <p>Your Facebook friend <a href="{{ event.actor.url_likes }}"><strong>{{ event.actor }}</strong> is now on APPRL!</span></a>
                                </p>
                            </span>
                        </span>
                    {% elif event.type == "SALE" %}                        
                        <span class="ncp-image">
                            <a href="{{ event.product.get_absolute_url }}">
								{% thumbnail event.product.product_image "32" crop="noop" as im %}
                                <img class="img-circle" src="{{ im.url }}" alt="{{ event.actor }}" title="{{ event.actor }}" width="32" height="32"/>
								{% endthumbnail %}
                            </a>
                        </span>
                        <span class="ncp-message">
                           <span class="ncp-placeholder">
                               <p>
                                   <a href="{{ event.product.get_absolute_url }}">
                                       <strong>{{ event.product }}</strong>
                                   </a> is on sale! 
                               </p>
                           </span>
                        </span>
                        
                    {% elif event.type == "FOLLOW" %}
                        <span class="ncp-image">
                            <a href="{{ event.actor.url_likes }}">
                                <img class="img-circle"  src="{{ event.actor.avatar_small }}" alt="{{ event.actor }}" title="{{ event.actor }}" width="32" height="32"/>
                            </a></span>
                        <span class="ncp-message">
                            <span class="ncp-placeholder">
                                <p>
                                    <a href="{{ event.actor.url_likes }}"><strong>{{ event.actor }}</strong> started following you!</a>
                                </p>
                            </span>
                        </span>
                    {% endif %}
                    <span class="ncp-time">{{ event.created|since }}</span>
				</li>
            {% empty %}
                <li><div class="row-fluid notification-row" style="width: auto;">
                        <span class="notification-content col-md-12">
                            You don't have any notifications yet!
                        </span>
                </div></li>
            {% endfor %}
            {% endlocaltime %}
            {% comment %}
             {% for event in request.user.notifications %}
                <li>
                    {% if event.type == "LIKELOOK" %}
                        <span class="image"><a href="{{ event.actor.url_likes }}"><img src="{{ event.actor.avatar_small }}" alt="{{ event.actor }}"></a></span>
                        <span class="message"><span class="placeholder"><p>
                            <a href="{{ event.actor.url_likes }}">{{ event.actor }}</a> liked your look <a href="{{ event.look.get_absolute_url }}">{{ event.look.title }}</a>
                        </p></span></span>
                    {% elif event.type == "FB" %}
                        <span class="image"><a href="{{ event.actor.url_likes }}"><img src="{{ event.actor.avatar_small }}" alt="{{ event.actor }}"></a></span>
                        <span class="message"><span class="placeholder"><p>
                           Your Facebook friend <a href="{{ event.actor.url_likes }}"><span class="name">{{ event.actor }}</span></a> is now on APPRL!
                        </p></span></span>
                    {% elif event.type == "SALE" %}
                        {% thumbnail event.product.product_image "32" crop="noop" as im %}
                        <span class="image"><a href="{{ event.product.get_absolute_url }}"><img src="{{ im.url }}" alt="{{ event.product }}"></a></span>
                        <span class="message"><span class="placeholder"><p>
                            <a href="{{ event.product.get_absolute_url }}"><i><span class="name">{{ event.product }}</span></i></a> is on sale! <span style="color: #e27b67;">{{ event.sale_new_price }}</span> <span style="text-decoration: line-through;">{{ event.sale_old_price }}</span> {{ event.currency }}
                        </p></span></span>
                        {% endthumbnail %}
                    {% elif event.type == "FOLLOW" %}
                        <span class="image"><a href="{{ event.actor.url_likes }}"><img src="{{ event.actor.avatar_small }}" alt="{{ event.actor }}"></a></span>
                        <span class="message"><span class="placeholder"><p>
                            <a href="{{ event.actor.url_likes }}"><span class="name">{{ event.actor }}</span></a> started following you!
                        </p></span></span>

                    {% endif %}
                     <span class="time">{{ event.created|since }}</span>
                </li>
            {% empty %}
             <div class="row-fluid notification-row" style="width: auto;">
                <a href="{{ request.user.url_likes }}">
                    <span class="col-md-5"></span>
                    <span id="see-all" class="col-md-2">
                        See all
                    </span>
                    <span class="col-md-5"></span>
                </a>
            </div>
            {% endcomment %}
        </ul>
    </li>

    <script>
        $(document).ready(function(){
            $(".notification-dropdown").click(function() {
                $('.ncp-time').each(function(i, obj) {
                    var text = obj.textContent;
                    text = text.replace('minutes', 'min');
                    text = text.replace('minute', 'min');
                    text = text.replace(' ago', '');
                    text = text.replace('hour', 'hr');
                    text = text.replace('hours', 'hrs');
                    obj.textContent = text;
                });
                var user_id = $(this).data("user");
                var unread_count = document.getElementById("unread_count");
                document.getElementById("unread_count").style.display = 'none';
                $.ajax({
                    type: "post",
                    url: "{% url 'notifications-seen' %}",
                    data: { user_id: user_id},
                    success: function (response) {
                        var json = jQuery.parseJSON(response);
                        alert(json);
                    }
                });
            });

            $(document).on( 'click', function(event) {
                if (!$(event.target).closest( '.ncp-notifications' ).length) {
                    if ( $( '.ncp-notifications' ).is( ':visible') ) {
                        $( '.notification-dropdown' ).toggleClass( 'active' );
                    }
                }
            });
        });


    </script>
