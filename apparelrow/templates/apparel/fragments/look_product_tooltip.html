{% load i18n thumbnail thumbnail_extras apparel_extras %}
<div id="tooltip-{{ product.id }}" class="tooltip">
  <div class="tooltip-container">
    <a{% if external %} target="_blank"{% endif %} href="{% if external and product.default_vendor and product.default_vendor.availability != 0 %}{% url product-click-count %}?i={{ product.id }}&u={{ product.default_vendor.buy_url|urlencode }}{% else %}{{ product.get_absolute_url }}{% endif %}" title="{{ product }}" class="product-image">
      {% thumbnail product.product_image "90x115" crop=False as im %}
      <img src="{{ im.url }}" alt="{{ product }}" width="{{ im.width }}" height="{{ im.height }}" style="margin:{{ im|positive_margin:'90x115' }}">
      {% endthumbnail %}
    </a>
    <div class="product-meta">
      <a{% if external %} target="_blank"{% endif %} href="{% if external and product.default_vendor and product.default_vendor.availability != 0 %}{% url product-click-count %}?i={{ product.id }}&u={{ product.default_vendor.buy_url|urlencode }}{% else %}{{ product.get_absolute_url }}{% endif %}" title="{{ product }}"><h2>{{ product.manufacturer.name }}</h2></a>
      {% if external %}
      <p class="product_name">{{ product.product_name }}</p>
      {% endif %}
      {% if product.default_vendor %}
      <div class="vendor_price">
        {% with product.default_vendor as vendor %}
        {% if vendor.discount_price %}
        <span class="discount-price price">{{ vendor.locale_discount_price|floatformat:0|apprl_intcomma }}</span>
        {% endif %}
        <span class="price"{% if vendor.locale_discount_price %} style="text-decoration:line-through;"{% endif %}>{{ vendor.locale_price|floatformat:0|apprl_intcomma }}</span>
        <span class="currency">{{ vendor.locale_currency }}</span>
        {% endwith %}
      </div>
      {% endif %}
      {% if not external %}
      <div class="product_stats">
        {% if product.score > 0 %}
        <span class="likes">{{ product.score }}</span>
        {% endif %}
        {% if product.comment_count > 0 %}
        <span class="comments">{{ product.comment_count }}</span>
        {% endif %}
      </div>
      {% endif %}
      <div class="vendor_button">
      {% if external %}
        {% if product.default_vendor and product.default_vendor.availability != 0 %}
        <a{% if external %} target="_blank"{% endif %} class="buy-now" href="{% url product-click-count %}?i={{ product.id }}&u={{ product.default_vendor.buy_url|urlencode }}">{% trans "Buy" %}</a>
        {% else %}
        <span class="sold-out">{% trans "Sold out" %}</span>
        {% endif %}
      {% else %}
        <a{% if external %} target="_blank"{% endif %} href="{{ product.get_absolute_url }}">{% trans "More info" %}</a>
      {% endif %}
      </div>
    </div>
  </div>
  <div class="tooltip-arrow"></div>
</div>
