{% load i18n cache thumbnail thumbnail_extras humanize %}
<ul class="products">
{% for product in products %}
    {% cycle '<li>' '<li class="last">' %}
    {% cache CACHE_TIMEOUT products_sidebar product.id LANGUAGE_CODE %}
    <a title="{{ product.product_name }}" href="{{ product.get_absolute_url }}">
        <div class="product-small">
            <div class="product-image">
                {% thumbnail product.product_image "93x121" crop=False as im %}
                <img src="{{ im.url }}" alt="{{ product.product_name }}" width="{{ im.width }}" height="{{ im.height }}" style="margin:{{ im|positive_margin:'93x121' }}">
                {% endthumbnail %}
                <span class="likes">x</span>
            </div>
            <h4>{{ product.manufacturer }}</h4>
            {% if not product.default_vendor or product.default_vendor.availability == 0 %}
            <span class="sold-out">{% trans "SOLD OUT" %}</span>
            {% else %}
                {% if product.default_vendor.discount_price %}
                <span class="discount-price">{{ product.default_vendor.discount_price|floatformat:0|intcomma }} {{ product.default_vendor.currency }}</span>
                <span class="price discounted">{{ product.default_vendor.price|floatformat:0|intcomma }} {{ product.default_vendor.currency }}</span>
                {% else %}
                <span class="price">{{ product.default_vendor.price|floatformat:0|intcomma }} {{ product.default_vendor.currency }}</span>
                {% endif %}
            {% endif %}
        </div>
    </a>
    {% endcache %}
    </li>
{% endfor %}
</ul>
