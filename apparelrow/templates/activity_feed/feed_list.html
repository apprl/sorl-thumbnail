{% extends "base.html" %}
{% load i18n %}

{% block full-title %}APPRL - The Social Commerce Platform | {% trans "Apparel, shoes, bags & accessories from the best online stores selected by bloggers & brands" %}{% endblock %}
{% block meta_description %}{% trans "Discover fashion from the world's best stores selected by bloggers, your friends & other stylemakers." %}{% endblock %}

{% block extra-scripts %}
<script type="text/javascript">
    $(function() {
        $('.feed-list .feed-verb-like_product').each(function(i, element) {
            var feed_user_id = $(element).data('user-id');
            var buy_button = $(element).find('.btn-product-buy');
            if (buy_button.length > 0) {
                var buy_url = buy_button.attr('href');
                if(typeof buy_url != 'undefined') {
                    buy_url = buy_url.replace('Shop/0/', 'Feed/' + feed_user_id + '/');
                    $('.hover .btn-product-buy', element).attr('href', buy_url);
                }
            }
        });
    });
</script>
{% endblock %}

{% block body-classes %}feed-list-page{% endblock body-classes %}
{% block full-body %}

    {% comment %}
    {% if not request.COOKIES.ar_featured and not request.GET.first %}
    {% include 'apparel/fragments/featured.html' with request=request featured=featured in_feed=True %}
    {% endif %}
    {% endcomment %}

    {% if request.GET.first and request.user.is_authenticated %}
    <div class="container">
        <div class="alert alert-success alert-dismissable">
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
            {% url 'profile-likes' request.user.slug as profile_url %}
            {% url 'user-list' as members_url %}
            {% blocktrans with members_url=members_url profile_url=profile_url %}This is your personal Apprl feed with the latest from your follows. <a href="{{members_url}}">Discover more people, bloggers & brands to follow here</a> and <a href="{{profile_url}}">manage who you follow here</a>.{% endblocktrans %}
        </div>
    </div>
    {% endif %}

    <div class="container">
        <div class="body-header">
            <h1>{% trans "Your Feed" %}</h1>
            <ul class="sidebar">
                <li class="dropdown">
                    <button type="button" class="btn btn-gender dropdown-toggle" data-toggle="dropdown">{% if gender == 'M' %}{% trans "Only men's" %}{% elif gender == 'W' %}{% trans "Only women's" %}{% else %}{% trans "Show all" %}{% endif %} <span class="caret"></span></button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="{% url 'index-all' %}">{% trans "Show all" %}</a></li>
                        <li><a href="{% url 'index-men' %}">{% trans "Only men's" %}</a></li>
                        <li><a href="{% url 'index-women' %}">{% trans "Only women's" %}</a></li>
                    </ul>
                </li>
            </ul>
        </div>

        {% include 'activity_feed/fragments/feed_list.html' %}

    </div>

{% endblock %}

{% block body-scripts %}
<script type="text/javascript">
(function() {
    currencyConversion($('.feed-list').find('.price, .discount-price'));
    $(document).on('infinite_scroll_data', function(event, content) {
        currencyConversion(content.find('.price, .discount-price'));
    });
})()

</script>
{% endblock %}
