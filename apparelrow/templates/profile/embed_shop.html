{% extends "base.html" %}
{% load i18n %}

{% block 'extra-scripts' %}
<script type="text/javascript">
    function updateQueryStringParameter(uri, key, value) {
        var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
        var separator = uri.indexOf('?') !== -1 ? "&" : "?";
        if (uri.match(re)) {
            return uri.replace(re, '$1' + key + "=" + value + '$2');
        } else {
            return uri + separator + key + "=" + value;
        }
    }
    jQuery(document).ready(function() {
        jQuery('#id_embed_code')
            .focus(function(e) { this.select(); })
            .mouseup(function(e) { e.preventDefault() });

        jQuery('#embed_shop_form').on('submit', function() {
            var width = jQuery('#id_width').val();
            var height = jQuery('#id_height').val();
            var language = jQuery('#id_language').val();
            var gender = jQuery('input[name=gender]:checked').val();

            if(!height) {
                height = '600';
                jQuery('#id_height').val(height);
            }

            var embed_code = $(jQuery('#shop_widget_template').html().replace(/WIDTH/g, width).replace('HEIGHT', height));
            var url = embed_code.find('iframe').attr('src');
            url = updateQueryStringParameter(url, 'language', language);
            url = updateQueryStringParameter(url, 'gender', gender) + '#!';
            embed_code.find('iframe').attr('src', url);

            jQuery('#id_embed_code').val(embed_code.get(0).outerHTML);

            return false;
        });
    });
</script>
{% endblock %}

{% block body-classes %}one-column profile-embed-shop{% endblock body-classes %}
{% block body %}
<div id="content">
    <h1>{% trans "Create a shop for your site" %}</h1>
    <form id="embed_shop_form" class="horizontal-form">
        <div class="control-group">
            <label class="control-label" for="id_width">{% trans "Width" %}</label>
            <div class="controls">
                <select id="id_width" name="width">
                    <option value="720">720px</option>
                    <option value="960">960px</option>
                    <option value="1200">1200px</option>
                </select>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="id_height">{% trans "Height" %}</label>
            <div class="controls">
                <input id="id_height" type="text" name="height"> px
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="id_language">{% trans "Language" %}</label>
            <div class="controls">
                <select id="id_language" name="language">
                    <option value="sv">{% trans "Swedish" %}</option>
                    <option value="en">{% trans "English" %}</option>
                    <option value="da">{% trans "Danish" %}</option>
                </select>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="id_gender_0">{% trans "Gender" %}</label>
            <div class="controls">
                <ul>
                    <li><label for="id_gender_0"><input id="id_gender_0" type="radio" name="gender" value="A" checked="checked">{% trans "Both" %}</label></li>
                    <li><label for="id_gender_1"><input id="id_gender_1" type="radio" name="gender" value="W">{% trans "Women" %}</label></li>
                    <li><label for="id_gender_2"><input id="id_gender_2" type="radio" name="gender" value="M">{% trans "Men" %}</label></li>
                </ul>
            </div>
        </div>
        <div class="control-group">
            <div class="controls">
                <button>{% trans "Get embed code" %}</button>
            </div>
        </div>

        <br><br>

        <div class="control-group">
            <label class="control-label" for="id_embed_code">{% trans "Embed code" %}</label>
            <div class="controls">
                <textarea id="id_embed_code" name="embed_code"></textarea>
            </div>
        </div>
    </form>
</div>
<script type="text/html" id="shop_widget_template">{% include 'apparel/fragments/shop_widget.html' %}</script>
{% endblock %}
