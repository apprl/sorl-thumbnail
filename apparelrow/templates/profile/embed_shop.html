{% extends "base.html" %}
{% load i18n %}

{% block 'extra-scripts' %}
<script type="text/javascript">
    function updateQueryStringParameter(uri, key, value) {
        var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
        var separator = uri.indexOf('?') !== -1 ? "&" : "?";
        if (uri.match(re)) {
            return uri.replace(re, '$1' + key + "=" + value + '$2');
        } else {
            return uri + separator + key + "=" + value;
        }
    }
    jQuery(document).ready(function() {
        jQuery('#id_embed_code')
            .focus(function(e) { this.select(); })
            .mouseup(function(e) { e.preventDefault() });

        jQuery('#embed_shop_form').on('submit', function() {
            var data = {
                width: jQuery('#id_width').val(),
                height: jQuery('#id_height').val(),
                language: jQuery('#id_language').val(),
                gender: jQuery('input[name=gender]:checked').val()
            };

            if(!data['height']) {
                data['height'] = '600';
                jQuery('#id_height').val(data['height']);
            }

            jQuery.post("{% url 'shop-widget' %}", data, function(response) {
                $('#id_embed_code').val(response);
                $('#id_embed_code').parents('.control-group').show();
            });

            return false;
        });
    });
</script>
{% endblock %}

{% block body-classes %}one-column profile-embed-shop{% endblock body-classes %}
{% block body %}
<div id="content">
    <h1>{% trans "Create a shop for your site/blog" %}</h1>
    <p>{% trans "It's easy to create a shop for your site/blog that includes all the products that you like on Apprl. Enter your preferred format below and paste the embed-code (in HTML-mode) into your site."%}</p>
    <form id="embed_shop_form" class="form-horizontal">
        <div class="control-group">
            <label class="control-label" for="id_width">{% trans "Width" %}</label>
            <div class="controls">
                <select id="id_width" name="width">
                    <option value="720">{% trans "720 pixels" %}</option>
                    <option value="960">{% trans "960 pixels" %}</option>
                    <option value="1200">{% trans "1200 pixels" %}</option>
                </select>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="id_height">{% trans "Height" %}</label>
            <div class="controls">
                <input id="id_height" type="text" name="height"> {% trans "pixels" %}
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="id_language">{% trans "Language" %}</label>
            <div class="controls">
                <select id="id_language" name="language">
                    {% for language in LANGUAGES %}
                    <option{% if language.0 == LANGUAGE_CODE %} selected="selected"{% endif %} value="{{ language.0 }}">{{ language.1 }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="id_gender_0">{% trans "Show" %}</label>
            <div class="controls">
                <label class="block" for="id_gender_0"><input id="id_gender_0" type="radio" name="gender" value="A" checked="checked">{% trans "All products" %}</label>
                <label class="block" for="id_gender_1"><input id="id_gender_1" type="radio" name="gender" value="W">{% trans "Only women's" %}</label>
                <label class="block" for="id_gender_2"><input id="id_gender_2" type="radio" name="gender" value="M">{% trans "Only men's" %}</label>
            </div>
        </div>
        <div class="control-group">
            <div class="controls">
                <button class="btn btn-upper btn-block">{% trans "Get embed code" %}</button>
            </div>
        </div>
        <div class="control-group" style="display:none;">
            <label class="control-label" for="id_embed_code">{% trans "Embed code" %}</label>
            <div class="controls">
                <textarea id="id_embed_code" name="embed_code"></textarea>
            </div>
        </div>
    </form>
</div>
{% endblock %}
