{% load i18n apparel_extras django_static %}
<!doctype html>
<html lang="{{ request.LANGUAGE_CODE }}">
<head{% block head-data %}{% endblock head-data %}>
    <title>{% block extra-title %}{% endblock %}Apprl - Social Shopping</title>
    <meta charset="utf-8" />
    <meta name="description" content="{% block meta_description %}{% trans "Follow your favourite brands, bloggers & friends to discover fashion you love." %}{% endblock %}">
    <link type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.21/themes/smoothness/jquery-ui.css" rel="stylesheet" />
    <link rel="stylesheet" href="{{ MEDIA_URL }}{% staticfile "styles/screen.css" %}" type="text/css" media="screen, projection">
    <link rel="stylesheet" href="{{ MEDIA_URL }}{% staticfile "styles/print.css" %}" type="text/css" media="print">
    <link rel="shortcut icon" href="{{ MEDIA_URL }}{% staticfile "images/favicon.ico" %}">
    <link href='http://fonts.googleapis.com/css?family=Lato:400|IM+Fell+Great+Primer:400italic' rel='stylesheet' type='text/css'>
    {% block extra-styles %}
    {% endblock extra-styles %}
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.21/jquery-ui.min.js"></script>
    <script type="text/javascript">
        var hasLiked = {% if user.is_authenticated and user.get_profile.has_liked %}true{% else %}false{% endif %};
        var dialog_like_product = '{% url dialog-like-product %}';
        var dialog_like_look = '{% url dialog-like-look %}';
        var product_popup_url = '{% url product-popup %}';
        var browse_url = '{% gender_url APPAREL_GENDER 'shop' %}';
        var isAuthenticated = {% if user.is_authenticated %}true{% else %}false{% endif %};
        var isFirstTimeVisit = {% if user.is_authenticated and user.get_profile.first_visit %}true{% else %}false{% endif %};
        var share_settings = {
            'like_product': {% if user.is_authenticated and user.get_profile.fb_share_like_product %}true{% else %}false{% endif %},
            'like_look': {% if user.is_authenticated and user.get_profile.fb_share_like_look %}true{% else %}false{% endif %},
            'follow_profile': {% if user.is_authenticated and user.get_profile.fb_share_follow_profile %}true{% else %}false{% endif %},
            'create_look': {% if user.is_authenticated and user.get_profile.fb_share_create_look %}true{% else %}false{% endif %}
        };

        window.fbAsyncInit = function() {
            FB.init({appId: {{ FACEBOOK_APP_ID }}, status: true, cookie: true, xfbml: true, channelUrl: '//{{ CURRENT_DOMAIN }}{{ MEDIA_URL }}channel.html'});
            FB.getLoginStatus(function(response) {
                if(!response.authResponse) {
                    jQuery('#ar-facepile').html('').addClass('ar-facepile');
                } else {
                    {% block facebook_code %}{% endblock %}
                }
            });
        }
    </script>
    <script type="text/javascript" src="{% url django.views.i18n.javascript_catalog %}"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}{% staticfile "js/compiled/jquery.js" %}"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}{% staticfile "js/apparel.js" %}"></script>
    <script type="text/javascript">
         function facebookConnect(form){
            var label = '';
            if(form.parents('#footer').length) {
                label = 'Footer';
            } else if(form.parents('#header').length) {
                label = 'Header';
            } else if(form.parents('#panel').length) {
                label = 'Socialize';
            } else if(form.parents('.dialog').length) {
                label = 'Dialog';
            } else {
                label = form.parent().attr('class') || 'Unknown';
            }

            // Track facebook connect clicks to GA
            _gaq.push(['_trackEvent', 'Membership', 'Signup', label]);

            function handleResponse(response){
                if (response.authResponse) {
                    jQuery('input[name="access_token"]', form).val(response.authResponse.accessToken);
                    jQuery('input[name="uid"]', form).val(response.authResponse.userID);
                    form.submit();
                }
            }
            FB.login(handleResponse, {scope: '{{ FACEBOOK_SCOPE }}'});
        };

        jQuery(document).ready(function() {
            // FIXME: quick solution to not have to send the form to validate
            jQuery('.create-look-dialog form').live('submit', function(e) {
                if(!jQuery(this).find('#id_title').val()) {
                    if(!jQuery(this).find('.errorlist').length) {
                        var error_list = jQuery('<ul class="errorlist">').append(jQuery('<li>').text('{% trans "You have to name your look before your create it." %}'));
                        jQuery(this).find('#id_title').after(error_list);
                    }
                    return false;
                }
            });

            jQuery('.ar_welcome').click(function() {
                jQuery('#panel').slideToggle('slow');
                $(this).toggleClass("active");
                var date = new Date();
                date.setTime(date.getTime()+(10000*24*60*60*1000));
                document.cookie = "ar_welcome=1; expires="+date.toUTCString()+"; path=/";
            });
        });
    </script>
    {% block 'extra-scripts' %}
    {% endblock 'extra-scripts' %}
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', '{{ GOOGLE_ANALYTICS_ACCOUNT }}']);
        _gaq.push(['_setDomainName', '{{ GOOGLE_ANALYTICS_DOMAIN }}']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>
<body class="{% block body-classes %}{% endblock %}">

 <div id="outer">
    <div id="header">
        <div id="inner-header">
            <a class="page-logo" href="{% gender_url APPAREL_GENDER 'shop' %}">
                <img src="{{ MEDIA_URL }}{% staticfile "images/logo.png" %}" alt="Apprl">
            </a>

            <form action="/apparel/search" method="get" onSubmit="return false" id="search" autocomplete="off">
                <input type="text" name="s" placeholder="{% trans 'Search for products' %}" />
                <a href="{{ request.url }}" id="cancel-search">{% trans "Cancel" %}</a>
            </form>

            <ul id="nav-main">
                <li><a class="{% selected_url request "/feed" %}" href="{% url user_feed %}">{% trans "Feed" %}</a></li>
                <li><a class="{% selected_url request "/" "/products" %}" href="{% gender_url APPAREL_GENDER 'shop' %}">{% trans "Shop" %}</a></li>
                <li><a class="{% selected_url request "/looks" %}" href="{% gender_url APPAREL_GENDER 'look-list' %}">{% trans "Looks" %}</a></li>
                <li class="subnav-handle">
                    <a class="{% selected_url request "/users" "/brand" "/profile" %}" href="{% url user-list-popular %}">{% trans "Follow" %}</a>
                    <ul class="subnav" id="subnav-follow">
                        <li><a href="{% url user-list-popular %}">{% trans "Members" %}</a></li>
                        <li><a href="{% gender_url APPAREL_GENDER 'brand-list' %}">{% trans "Brands" %}</a></li>
                    </ul>
                </li>
            </ul>

            <ul id="nav-user">
                {% if not request.user.is_authenticated %}
                <li class="user facebook">{% apparel_facebook_button %}</li>
                {% else %}
                <li class="avatar"><a href="{{ request.user.get_profile.url_likes }}"><img src="{{ request.user.get_profile.avatar_small }}" width="32" height="32"></a></li>
                <li class="user subnav-handle">
                    <a class="{% selected_url request "/profile/settings" "/profile/"|add:request.user.get_profile.slug %}" href="{{ request.user.get_profile.url_likes }}">{{ request.user.get_profile.display_name }}</a>
                    <ul class="subnav" id="subnav-profile">
                        <li><a href="{{ request.user.get_profile.url_likes }}">{% trans "Your profile" %}</a></li>
                        <li><a href="{% url profile.views.settings_notification %}">{% trans "Settings" %}</a></li>
                        <li><a href="{% url auth_logout %}">{% trans "Log out" %}</a></li>
                    </ul>
                </li>
                {% endif %}
            </ul>

            <ul id="nav-global">
                <li class="gender subnav-gray-handle">
                    <a href="#">{% if APPAREL_GENDER == 'M' %}{% trans "Men" %}{% else %}{% trans "Women" %}{% endif %}</a>
                    <ul class="subnav-gray" id="subnav-gender">
                        <li><a href="{% change_gender_url request APPAREL_GENDER 'women' %}">{% trans "Women" %}</a></li>
                        <li><a href="{% change_gender_url request APPAREL_GENDER 'men' %}">{% trans "Men" %}</a></li>
                    </ul>
                </li>
                <li class="language subnav-gray-handle">
                    {% for language in SHORT_LANGUAGES %}
                    {% if language.0 == LANGUAGE_CODE %}
                    <a class="current language" href="{% url django.views.i18n.set_language %}">{% trans language.1 %}</a>
                    {% endif %}
                    {% endfor %}
                    <form action="{% url django.views.i18n.set_language %}" method="post" class="select-language">
                        {% csrf_token %}
                        <ul class="subnav-gray" id="subnav-language">
                        {% for language in LANGUAGES %}
                            <li class="{% if forloop.first %}first{% endif %}{% if forloop.last %}last{% endif %}">
                                {% if language.0 == LANGUAGE_CODE %}
                                <button class="disabled" name="language" value="{{ language.0 }}" type="submit">{% trans language.1 %}</button>
                                {% else %}
                                <button name="language" value="{{ language.0 }}" type="submit">{% trans language.1 %}</button>
                                {% endif %}
                            </li>
                        {% endfor %}
                        </ul>
                    </form>
                </li>
            </ul>
        </div>
    </div>

    <div id="search-result">
        <div id="inner-search-result">
            <div class="wide result-container">
                <h2 class="search-result-products">{% trans "Matching products" %}</h2>
                <div class="product-list"><ul id="search-result-products" class="list"></ul></div>
                <div class="search-link"><a class="search-result-products" href="#">{% trans "Show all products" %}</a></div>
            </div>
            <div class="result-container">
                <h2 class="search-result-looks">{% trans "Matching looks" %}</h2>
                <ul id="search-result-looks" class="looks"></ul>
                <div class="search-link"><a class="search-result-looks" href="#">{% trans "Show all looks" %}</a></div>
            </div>
            <div class="last result-container">
                <h2 class="search-result-manufacturers">{% trans "Matching brands" %}</h2>
                <ul id="search-result-manufacturers"></ul>
                <div class="search-link"><a class="search-result-manufacturers" href="#">{% trans "Show all manufacturers" %}</a></div>
            </div>
            <div id="search-result-clear" class="clear"></div>
        </div>
    </div>

    <div id="container">

        {% url apparel.browse.browse_products gender='W' as shop_w %}
        {% url apparel.browse.browse_products gender='M' as shop_m %}
        {% if not user.is_authenticated and not request.COOKIES.ar_welcome %}
        {% if request.path == shop_m or request.path == shop_w %}
        <div id="panel">
            <div id="panelwrap">
                <span class="row-span">
                    <h3 class="rowrubbe">{% trans "Socialize!" %}</h3>
                    <p class="p-row">{% trans "Connect your Facebook account to:" %}</p>
                    <ul>
                        <li>{% trans "Collect products you like under your profile" %}</li>
                        <li>{% trans "Follow your favourite brands, bloggers & members" %}</li>
                        <li>{% trans "See what clothes & looks your friends like" %}</li>
                    </ul>
                    <p class="p-row p-light">{% trans "You will always control what is being shared to your Facebook profile." %}</p>
                </span>
                <a class="btn-slide ar_welcome" href="#"></a>
                <div id="login-fb">
                    <p class="lifc">{% blocktrans %}Life is <em>more fun</em> connected{% endblocktrans %}</p>
                    {% apparel_facebook_button "facebook-hide.png" %}
                    <a href="{% url dialog-why-facebook %}" class="open-dialog dialog-why-facebook">{% trans "Why Facebook?" %}</a>
                </div>
                <div id="ar-facepile" class="bild">
                    <div class="fb-facepile" data-max-rows="2" data-width="281" data-app-id="{{ FACEBOOK_APP_ID }}"></div>
                </div>
            </div>
        </div>
        {% endif %}
        {% endif %}

        <div id="inner-container">
            {% block body-header %}{% endblock %}
            {% block body %}{% endblock %}
        </div>
    </div>

    <div id="footer">
        <div id="inner-footer">
            <ul class="copyright">
                <li><h3>Apprl Fashion AB</h3></li>
                <li>Birger Jarlsgatan 18A</li>
                <li>114 34 Stockholm</li>
                <li>{% trans "Sweden" %}</li>
            </ul>
            <ul>
                <li><h3>{% trans "Shop" %}</h3></li>
                <li><a class="women" href="{% gender_url 'W' 'shop' %}">{% trans "Women" %}</a></li>
                <li><a class="men" href="{% gender_url 'M' 'shop' %}">{% trans "Men" %}</a></li>
                <li><a href="{% gender_url APPAREL_GENDER 'look-list' %}">{% trans "Looks" %}</a></li>
                <li><a href="{% gender_url APPAREL_GENDER 'brand-list' %}">{% trans "Brands" %}</a></li>
            </ul>
            <ul>
                <li><h3>{% trans "Membership" %}</h3></li>
                {% if not user.is_authenticated %}
                <li class="facebook">{% apparel_facebook_button "facebook-footer.png" %}</li>
                {% endif %}
                <li><a href="{% url user-list %}">{% trans "Members" %}</a></li>
            </ul>
            <ul>
                <li><h3>{% trans "Follow us" %}</h3></li>
                <li><a target="_blank" href="http://www.facebook.com/apprl">{% trans "Facebook" %}</a></li>
                <li><a target="_blank" href="{% url newsletter-redirect %}">{% trans "E-mail newsletter" %}</a></li>
            </ul>
            <ul>
                <li><h3>{% trans "Apprl" %}</h3></li>
                <li><a href="{% url about %}">{% trans "About" %}</a></li>
                <li><a href="mailto:info@apprl.com">{% trans "Contact" %}</a></li>
                <li><a href="{% url django.contrib.flatpages.views.flatpage url='about/terms-of-use/' %}">{% trans "Privacy & Terms" %}</a></li>
                <li><a href="{% url django.contrib.flatpages.views.flatpage url='about/cookies/' %}">{% trans "Cookies" %}</a></li>
            </ul>
            <div class="fb-like footer-like" data-href="https://facebook.com/apprl/" data-send="false" data-width="250" data-show-faces="false"></div>
        </div>
    </div>
</div>

<a class="feedback" href="mailto:feedback@apprl.com?subject={% trans "Hi Apprl! I have a question / idea / complaint / complement" %}">
    <img src="{{ MEDIA_URL }}/images/feedback-button.png">
</a>

<div id="fb-root"></div>
<script type="text/javascript">
  (function(d){
     var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement('script'); js.id = id; js.async = true;
     js.src = "//connect.facebook.net/sv_SE/all.js";
     ref.parentNode.insertBefore(js, ref);
   }(document));
</script>

{% for template_name,template_string in templates.items %}
    <script type="text/html" id="{{ template_name }}_template">
        {{ template_string|safe }}
    </script>
{% endfor %}

<script type="text/html" id="error_dialog_template">
    <div class="dialog-container {% block dialog_class %}{% endblock %}">
        <h1>${ header }</h1>
        <div class="bodycopy content">
            {% templatetag openvariable %}each(i, message) messages{% templatetag closevariable %}
            <p>${ message }</p>
            {% templatetag openvariable %}/each{% templatetag closevariable %}
        </div>
        <div class="dialog-footer">
            <button class="no">{% trans "No" %}</button>
            <button class="yes">{% trans "Yes" %}</button>
        </div>
    </div>
</script>

{% block body-scripts %}{% endblock body-scripts %}

</body>
</html>
