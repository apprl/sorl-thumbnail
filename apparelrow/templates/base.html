{% load i18n l10n apparel_extras compressed login_bar cache localeurl_tags %}
{% load static from staticfiles %}
<!DOCTYPE html>
<html lang="{{ request.LANGUAGE_CODE }}">
<head{% block head-data %}{% endblock head-data %}>

    <title>{% block full-title %}{% block extra-title %}{% endblock %}APPRL - The Social Commerce Platform{% endblock %}</title>
    <meta charset="utf-8" />
    <meta name="description" content="{% spaceless %}{% block meta_description %}{% endblock %}{% endspaceless %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    {% for language in LANGUAGES_DISPLAY %}
    <link rel="alternate" hreflang="{{ language.0 }}" href="{{ request.path|chlocale:language.0 }}">
    {% endfor %}
    <link rel="icon" href="{% static "images/favicon.png" %}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static "images/apple-touch-icon-120x120.png" %}">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static "images/apple-touch-icon-152x152.png" %}">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    {% if not has_share_image %}
        <meta property="og:image" content="{% static "images/share-image.jpg" %}">
    {% endif %}
    <link rel="image_src" href="{% static "images/share-image.jpg" %}">

    {% compressed_css 'bootstrap' %}
    {% block extra-styles %}
    {% endblock %}
    <script type="text/javascript">var addToHomeConfig = {returningVisitor: true, touchIcon: true, expire: 20160};</script>
    <script src="//cdn.optimizely.com/js/180383028.js"></script>
    {% block pre-extra-scripts %}{% endblock %}
    {% compressed_js 'main' %}

    <script type="text/javascript">
        var language_code = '{{ LANGUAGE_CODE }}';
        var product_popup_url = '{% url "product-popup" %}';
        var look_popup_url = '{% url "look-popup" %}';
        var browse_url = '{% multi_gender_url request "shop" "shop" %}';
        var looks_search_url = '{% url "search-look-list" %}';
        var look_api_base_url = '{% url "look_list" %}';
        var create_store_api_base_url = '{% url "create_shop" %}';
        var create_product_widget_api_base_url = '{% url "product_widget-api" %}';

        var isAuthenticated = {% if user.is_authenticated %}true{% else %}false{% endif %};
        {% if request.user.is_authenticated %}
        var userID = {{ request.user.pk }};
        var isPartnerUser = {% if request.user.is_partner %}true{% else %}false{% endif %};
        {% endif %}
        var share_settings = {
            'like_product': {% if user.is_authenticated and user.fb_share_like_product %}true{% else %}false{% endif %},
            'like_look': {% if user.is_authenticated and user.fb_share_like_look %}true{% else %}false{% endif %},
            'follow_profile': {% if user.is_authenticated and user.fb_share_follow_profile %}true{% else %}false{% endif %},
            'create_look': {% if user.is_authenticated and user.fb_share_create_look %}true{% else %}false{% endif %}
        };
        var facebook_scope = '{{ FACEBOOK_SCOPE }}';
        var facebook_login_uri = 'https://m.facebook.com/dialog/oauth?client_id={{ FACEBOOK_APP_ID }}&response_type=code&redirect_uri={{ FACEBOOK_REDIRECT_URI }}&scope={{ FACEBOOK_SCOPE }}';
        window.fbAsyncInit = function() {
            FB.init({appId: {{ FACEBOOK_APP_ID }}, status: true, cookie: true, xfbml: true, channelUrl: '//{{ CURRENT_DOMAIN }}/channel.html'});
            FB.getLoginStatus(function(response) {
                if(!response.authResponse) {
                    $('.facepile-container').html('').addClass('ar-facepile');
                } else {
                    {% block facebook_code %}{% endblock %}
                }
            });
        }
        window.login_function = function(callback) {
            FB.login(function(response) {
                if(response.authResponse) {
                    data = {uid: response.authResponse.userID, access_token: response.authResponse.accessToken};
                    $.post('/facebook/login', data, function(response) {
                        if(response) {
                            callback(response.next);
                        }
                    });
                }
            }, {scope: facebook_scope});
        };
    </script>
    {% block extra-scripts %}
    {% endblock %}
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', '{{ GOOGLE_ANALYTICS_UNIVERSAL_ACCOUNT }}', {'cookieDomain': '{{ GOOGLE_ANALYTICS_UNIVERSAL_DOMAIN }}'});
        ga('send', 'pageview');

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', '{{ GOOGLE_ANALYTICS_ACCOUNT }}']);
        _gaq.push(['_setDomainName', '{{ GOOGLE_ANALYTICS_DOMAIN }}']);
        _gaq.push(['_setSiteSpeedSampleRate', 10]);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>
<body class="{% if request.user.is_authenticated %}authenticated {% endif %}{% block body-classes %}{% endblock %}">
    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id={{ GOOGLE_TAG_MANAGER_CONTAINER_ID }}"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','{{ GOOGLE_TAG_MANAGER_CONTAINER_ID }}');</script>
    <!-- End Google Tag Manager -->

    <div id="fb-root"></div>
    <script type="text/javascript">
        (function(d){
        var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
        if (d.getElementById(id)) {return;}
            js = d.createElement('script'); js.id = id; js.async = true;
            js.src = "//connect.facebook.net/en_US/all.js";
            ref.parentNode.insertBefore(js, ref);
        }(document));
    </script>

    {# Header #}
    <header role="banner" {% if is_welcome_page %}style="display:none;"{% endif %}>
        <nav role="navigation">
            <div class="container">
                <a class="logo" href="/"><img src="{% static 'images/logo.svg' %}" alt="APPRL" /></a>
                {# request.path == onboarding #}
                {# request.path #}
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar top-bar"></span>
                    <span class="icon-bar middle-bar"></span>
                    <span class="icon-bar bottom-bar"></span>
                </button>

                <div class="navbar-collapse collapse navbar-responsive-collapse" id="menu">
                    <ul class="primary-nav">
                        {% if not request.user.is_authenticated %}
                        <li class="visible-xs visible-sm"><a href="{% url 'auth_register' %}">{% trans "Get started" %}</a></li>
                        <li class="visible-xs visible-sm"><a href="{% url 'auth_login' %}">{% trans "Log in" %}</a></li>
                        {% endif %}
                        {% if request.user.is_authenticated %}
                        <li class="visible-xs visible-sm"><a class="link-create" href="{% url 'publisher-tools' %}">{% if request.user.is_partner %}{% trans "Create & Earn" %}{% else %}{% trans "Create" %}{% endif %} <i class="fa fa-caret-right"></i></a></li>
                        <li class="visible-xs visible-sm dropdown {% selected_url request "/profile/settings" "/profile/"|add:request.user.slug %}">
                            <a class="dropdown-toggle dropdown-avatar" data-toggle="dropdown" href="{{ request.user.url_likes }}"><img class="profile-icon" src="{{ request.user.avatar_small }}"><u>{% trans 'You' %} <b class="caret"></b> </u></a>
                            <ul class="dropdown-menu">
                                <li><a href="{{ request.user.url_likes }}">{% trans "Profile" %}</a></li>
                                {% if request.user.advertiser_store %}
                                <li><a href="{% url 'advertiser-store-admin' %}">{% trans "Your store" %}</a></li>
                                {% endif %}
                                {% if request.user.is_partner %}
                                <li><a href="{% url 'dashboard' %}">{% trans "Dashboard" %}</a></li>
                                {% if not request.user.advertiser_store %}
                                <li><a href="{% url 'dashboard-commissions' %}">{% trans "Store Commissions" %}</a></li>
                                {% endif %}
                                {% endif %}
                                <li><a class="facebook-invite" href="#invite">{% trans "Invite friends" %}</a></li>
                                <li><a href="{% url 'settings-email' %}">{% trans "Settings" %}</a></li>
                                <li><a href="{% url 'auth_logout' %}">{% trans "Log out" %}</a></li>
                            </ul>
                        </li>
                        <!--<li class="visible-xs visible-sm"><a href="{% url 'notifications-page' %}">{% trans "Notifications" %}</span>{# if request.user.unread_count > 0 #}<span class="unread_count badge">{{ request.user.unread_count }}</span>{# endif #}</a></li>-->
                        <li class="visible-xs visible-sm">
                            <a class="notifications" href="{% url 'notifications-page' %}">
                                <span class="icon">
                                    <?xml version="1.0" encoding="utf-8" standalone="no"?>
                                    <svg width="9px" height="16px" viewBox="0 0 9 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                        <g stroke="none" stroke-width="1" fill="none">
                                            <g fill="#ffffff">
                                                <path d="M5.56425,5.4157037 L7.61271429,0.231407407 L1.854,0.231407407 L0.297321429,7.78607407 L3.17667857,7.78607407 L1.25228571,15.7685926 L8.70235714,5.4157037 L5.56425,5.4157037 L5.56425,5.4157037 Z"></path>
                                            </g>
                                        </g>
                                    </svg>
                                    <span id="unread_count" class="unread_count badge">4</span>
                                    {% if request.user.unread_count > 0 %}<span id="unread_count" class="unread_count badge">{{ request.user.unread_count }}</span>{% endif %}
                                </span>
                                &nbsp;{% trans "Notifications" %}
                             </a>
                        </li>
                        <hr class="visible-xs visible-sm">
                        <li class="{% selected_url request "/" %}"><a href="{% multi_gender_url request 'feed' 'index' %}"><u>{% trans "Feed" %}</u>{# <span class="unread_count badge"></span> #}</a></li>
                        <li class="{% selected_url request "/shop" "/products" %}"><a data-shop="true" href="{% multi_gender_url request 'shop' 'shop' %}"><u>{% trans "Shop" %}</u></a></li>
                        <li class="dropdown {% selected_url request "/brands" "/users" %}">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="{% multi_gender_url request 'user' 'user-list' %}"><u>{% trans "Discover" %} <b class="caret"></b></u></a>
                            <ul class="dropdown-menu">
                                <li><a href="{% multi_gender_url request 'user' 'look-list' %}">{% trans "Looks" %}</a></li>
                                <li><a href="{% multi_gender_url request 'user' 'brand-list' %}">{% trans "Brands" %}</a></li>
                                <li><a href="{% multi_gender_url request 'user' 'user-list' %}">{% trans "Members" %}</a></li>
                            </ul>
                        </li>
                        {% endif %}
                    </ul>

                    {% if request.user.is_authenticated %}
                    <a class="btn btn-outline btn-create hidden-xs visible-md visible-lg"
                    {% if request.user.is_partner %}
                    href="{% url 'publisher-tools' %}">
                    {% trans "Create & Earn" %}
                    {% else %}
                    href="{% url 'look-create' %}">
                    {% trans "Create" %}
                    {% endif %}</a>
                    {% endif %}

                    <ul class="secondary-nav">
                        {% if not request.user.is_authenticated %}
                        <li class="hidden-xs hidden-sm"><a href="{% url 'index-community' %}"><u>{% trans "Sign Up" %}</u></a></li>
                        <li class="hidden-xs hidden-sm"><a href="{% url 'auth_login' %}"><u>{% trans "Log in" %}</u></a></li>
                        {% else %}
                        {% include 'apparel/fragments/notification_list.html' with request=request csrf_token=csrf_token next=next only %}
                        <li class="visible-md visible-lg dropdown {% selected_url request "/profile/settings" "/profile/"|add:request.user.slug %}">
                            <a class="dropdown-toggle dropdown-avatar" data-toggle="dropdown" href="{{ request.user.url_likes }}"><img class="profile-icon" src="{{ request.user.avatar_small }}"><u>{% trans 'You' %} <b class="caret"></b> </u></a>
                            <ul class="dropdown-menu">
                                <li><a href="{{ request.user.url_likes }}">{% trans "Profile" %}</a></li>
                                {% if request.user.advertiser_store %}
                                <li><a href="{% url 'advertiser-store-admin' %}">{% trans "Your store" %}</a></li>
                                {% endif %}
                                {% if request.user.is_partner %}
                                <li><a href="{% url 'dashboard' %}">{% trans "Dashboard" %}</a></li>
                                {% if not request.user.advertiser_store %}
                                <li><a href="{% url 'dashboard-commissions' %}">{% trans "Store Commissions" %}</a></li>
                                {% endif %}
                                {% endif %}
                                <li><a class="facebook-invite" href="#invite">{% trans "Invite friends" %}</a></li>
                                <li><a href="{% url 'settings-email' %}">{% trans "Settings" %}</a></li>
                                <li><a href="{% url 'auth_logout' %}">{% trans "Log out" %}</a></li>
                            </ul>
                        </li>
                        <hr class="visible-xs visible-sm">
                        <li class="visible-xs visible-sm dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="{{ request.path }}"><span>{% get_location_text request.location %} <b class="caret"></b></span></a>
                            <ul id="language-dropdown" class="dropdown-menu">
                            {% for location in LOCATION_LANGUAGE_MAPPING %}
                                <li><a data-language="{{ location.2.0 }}" data-location="{{ location.0 }}" href="{{ request.path|chlocale:location.2.0 }}">{{ location.1 }}</a></li>
                            {% endfor %}
                            </ul>
                        </li>
                        <li class="search-box">
                            <form data-search="true" action="{% multi_gender_url request 'shop' 'search' %}" class="navbar-form" autocomplete="off" id="search">
                                <button class="btn-search" type="submit"><i class="fa fa-search"></i></button>
                                <input type="search" name="q" placeholder="{% trans 'Search anything' %}" />
                            </form>
                        </li>
                        {% endif %}
                    </ul>
                </div>
                {# endif #}
            </div>
        </nav>
    </header>

    {# Main #}
    <main role="main" id="content-container" class="{% block body-container-classes %}{% endblock %}">
        {% block full-body %}
        <div class="container">
            {% block body-header %}{% endblock %}
            {% block body %}{% endblock %}
        </div>
        {% endblock %}
    </main>

    {# Footer #}
    <footer role="contentinfo">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <div class="row">
                        <div class="col-is-6">
                            <h5>{% trans 'Your Location' %}</h5>
                            <ul>
                                <li class="dropdown">
                                {% if request.user.is_authenticated %}
                                    <a class="btn btn-sm btn-grey" href="{% url 'settings-email' %}#location">{% get_location_text request.location %}</a>
                                {% else %}
                                    <a class="btn btn-sm btn-grey dropdown-toggle" data-toggle="dropdown" href="{{ request.path }}"><span>{% get_location_text request.location %} <b class="caret"></b></span></a>
                                    <ul id="language-dropdown" class="dropdown-menu">
                                        {% for location in LOCATION_LANGUAGE_MAPPING %}
                                            <li><a data-language="{{ location.2.0 }}" data-location="{{ location.0 }}" href="{{ request.path|chlocale:location.2.0 }}">{{ location.1 }}</a></li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                                </li>
                                <li><a href="{% url 'index-retailers' %}"><i>{% trans "Are you a retailer?" %}</i></a></li>
                            </ul>
                        </div>
                        <div class="col-is-6">
                            <h5>{% trans 'Shop' %}</h5>
                            <ul>
                                <li><a class="women" href="{% gender_url 'W' 'shop' %}">{% trans "Women" %}</a></li>
                                <li><a class="men" href="{% gender_url 'M' 'shop' %}">{% trans "Men" %}</a></li>
                                <li><a href="{% multi_gender_url request 'look' 'look-list' %}">{% trans "Looks" %}</a></li>
                                <li><a href="{% multi_gender_url request 'user' 'brand-list' %}">{% trans "Brands" %}</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="row">
                        <div class="col-is-6">
                            <h5>{% trans 'Follow Us' %}</h5>
                            <ul>
                                <li><a target="_blank" href="http://blog.apprl.com">{% trans 'Blog' %}</a></li>
                                <li><a target="_blank" href="http://www.facebook.com/apprl">Facebook</a></li>
                                <li><a target="_blank" href="http://instagram.com/get_apprl">Instagram</a></li>
                                <li><a target="_blank" href="https://twitter.com/get_apprl">Twitter</a></li>
                                <li><a target="_blank" href="http://pinterest.com/apprl/">Pinterest</a></li>
                                <li><a target="_blank" href="https://www.linkedin.com/company/apprl">LinkedIn</a></li>
                            </ul>
                        </div>
                        <div class="col-is-6">
                            <h5>{% trans 'APPRL' %}</h5>
                            <ul>
                                <li><a href="{% url 'about' %}">{% trans "About Us" %}</a></li>
                                <li><a href="{% url 'contact' %}">{% trans "Contact" %}</a></li>
                                <li><a href="{% url 'jobs' %}">{% trans "Jobs" %}</a></li>
                                <li><a href="{% url 'django.contrib.flatpages.views.flatpage' url='about/terms-of-use/' %}">{% trans "Terms & Conditions" %}</a></li>
                                <li><a href="{% url 'django.contrib.flatpages.views.flatpage' url='about/cookies/' %}">{% trans "Cookies" %}</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="row">
                        <div class="col-is-6">
                            <h5>Get our newsletter</h5>
                            <a class="btn btn-default" href="{% url 'newsletter-redirect' %}">{% trans "Sign Up" %}</a>
                            {% comment %}
                            <form action="http://apprl.us4.list-manage.com/subscribe/post" method="POST">
                                <input type="email" autocapitalize="off" autocorrect="off" id="MERGE0" placeholder="Your email" required="required" />
                                <input type="submit" value="Sign Up" />
                            </form>
                            {% endcomment %}
                        </div>
                        <div class="col-is-6">
                            <h5>APPRL Fashion AB</h5>
                            <address>
                                Kammakargatan 41<br>
                                111 24 Stockholm<br>
                                Sweden
                            </address>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <a class="btn-scroll btn-arrow scroll-top" href="#"><i class="fa fa-angle-up"></i>

    <script>
    $(document).ready(function(){
        $(".notification-mini").click(function() {
            var user_id = $(this).data("user");
            $.ajax({
                type: "post",
                url: "{% url 'notifications-seen' %}",
                data: { user_id: user_id },
                success: function (response) {
                    window.location.href = "{% url 'notifications-page' %}";
                }
            });

        });

        $(document).on( 'scroll', function(){
            if ($(window).scrollTop() > 100) {
                $('.btn-scroll').fadeIn(200);
            } else {
                $('.btn-scroll').fadeOut(200);
            }
        });

        $('.btn-scroll').on('click', function(e) {
            $('html, body').animate({scrollTop: 0}, 500);
            e.preventDefault();
        });
    });
    </script>

    {% include 'apparel/fragments/dialog_like_product.html' with request=request csrf_token=csrf_token next=next only %}
    {% include 'apparel/fragments/dialog_like_look.html' with request=request csrf_token=csrf_token next=next only %}
    {% include 'apparel/fragments/dialog_create_look.html' with request=request csrf_token=csrf_token next=next only %}
    {% include 'apparel/fragments/dialog_follow_user.html' with request=request csrf_token=csrf_token next=next only %}
    {% include 'apparel/fragments/dialog_become_member.html' with request=request csrf_token=csrf_token next=next only %}
    {% include 'apparel/fragments/dialog_contest_rules.html' with request=request LANGUAGES=LANGUAGES only %}
    <div class="modal fade" id="modal_embed_look" tabindex="-1"></div>
    {% if request.user.is_authenticated %}
    <div class="modal fade" id="modal_embed_look" tabindex="-1"></div>
    <div class="modal fade" id="modal_embed_shop" tabindex="-1"></div>

    <script type="text/html" id="user_like_template">
        <li data-user-id="{{ request.user.pk }}"><a href="{{ request.user.get_absolute_url }}" title="{{ request.user.display_name }}"><img class="img-circle" alt="{{ request.user.display_name }}" title="{{ request.user.display_name }}" src="{{ request.user.avatar }}"></a></li>
    </script>
    {% endif %}

<script type="text/javascript" src="{% static "js/money.min.js" %}"></script>
<script type="text/javascript">
  fx.base = 'SEK';
  fx.rates = {
    {% for currency, rate in currency_rates.items %}
    '{{ currency }}': {{ rate|unlocalize }},
    {% endfor %}
    'SEK': 1
  };

  var current_currency = '{{ CURRENCY }}';
  function formatNumber(num) {
    var array = parseInt(num, 10).toFixed().split('');
    var index = -3;
    while (array.length + index > 0) {
      array.splice(index, 0, ' ');
      index -= 4;
    }
    return array.join('');
  };
  function currencyConversion(elements) {
    elements.each(function(index, element) {
      var $element = jQuery(element);
      var data = $element.data();
      var converted_price = Math.round(fx.convert(data.price, {from: data.currency, to: current_currency}));
      $element.text(formatNumber(converted_price) + ' ' + current_currency);
  });
}

  $('#language-dropdown > li > a').click(function(event){
      var $this = $(this);
      var location = $this.data("location");
      $.removeCookie('location');
      $.cookie('location', location, { expires: 60, path: '/' });
  } );
</script>

{% include 'mouseflow.html' only %}

{% block body-scripts %}{% endblock %}

{% comment %}
{% block pinterest-scripts %}
<script type="text/javascript" src="//assets.pinterest.com/js/pinit.js"></script>
{% endblock %}
{% endcomment %}

</body>
</html>