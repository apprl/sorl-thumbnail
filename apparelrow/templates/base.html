{% load i18n l10n apparel_extras compressed login_bar cache %}
{% load static from staticfiles %}
<!DOCTYPE html>
<html lang="{{ request.LANGUAGE_CODE }}">
<head{% block head-data %}{% endblock head-data %}>
    <title>{% block full-title %}{% block extra-title %}{% endblock %}Apprl - Social Shopping{% endblock %}</title>
    <meta charset="utf-8" />
    <meta name="description" content="{% spaceless %}{% block meta_description %}{% endblock %}{% endspaceless %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="shortcut icon" href="{% static "images/favicon.ico" %}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static "images/apple-touch-icon-120x120.png" %}">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static "images/apple-touch-icon-152x152.png" %}">
    <link href='http://fonts.googleapis.com/css?family=Lato:400|IM+Fell+Great+Primer:400italic' rel='stylesheet' type='text/css'>
    {% compressed_css 'bootstrap' %}
    {% block extra-styles %}
    {% endblock extra-styles %}
    <script type="text/javascript">var addToHomeConfig = {returningVisitor: true};</script>
    <script src="//cdn.optimizely.com/js/180383028.js"></script>
    <script type="text/javascript" src="{% url 'django.views.i18n.javascript_catalog' %}"></script>
    {% block pre-extra-scripts %}{% endblock %}
    {% compressed_js 'main' %}
    <script type="text/javascript">
        var product_popup_url = '{% url "product-popup" %}';
        var look_popup_url = '{% url "look-popup" %}';
        var browse_url = '{% multi_gender_url request 'shop' 'shop' %}';
        var isAuthenticated = {% if user.is_authenticated %}true{% else %}false{% endif %};
        {% if request.user.is_authenticated %}
        var userID = {{ request.user.pk }};
        var isPartnerUser = {% if request.user.is_partner %}true{% else %}false{% endif %};
        {% endif %}
        var share_settings = {
            'like_product': {% if user.is_authenticated and user.fb_share_like_product %}true{% else %}false{% endif %},
            'like_look': {% if user.is_authenticated and user.fb_share_like_look %}true{% else %}false{% endif %},
            'follow_profile': {% if user.is_authenticated and user.fb_share_follow_profile %}true{% else %}false{% endif %},
            'create_look': {% if user.is_authenticated and user.fb_share_create_look %}true{% else %}false{% endif %}
        };
        var facebook_scope = '{{ FACEBOOK_SCOPE }}';

        window.fbAsyncInit = function() {
            FB.init({appId: {{ FACEBOOK_APP_ID }}, status: true, cookie: true, xfbml: true, channelUrl: '//{{ CURRENT_DOMAIN }}/channel.html'});
            FB.getLoginStatus(function(response) {
                if(!response.authResponse) {
                    $('.facepile-container').html('').addClass('ar-facepile');
                } else {
                    {% block facebook_code %}{% endblock %}
                }
            });
        }
        window.login_function = function(callback) {
            FB.login(function(response) {
                if(response.authResponse) {
                    data = {uid: response.authResponse.userID, access_token: response.authResponse.accessToken};
                    $.post('/facebook/login', data, function(response) {
                        if(response) {
                            callback(response.next);
                        }
                    });
                }
            }, {scope: facebook_scope});
        };
    </script>
    {% block 'extra-scripts' %}
    {% endblock 'extra-scripts' %}
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', '{{ GOOGLE_ANALYTICS_UNIVERSAL_ACCOUNT }}', {'cookieDomain': '{{ GOOGLE_ANALYTICS_UNIVERSAL_DOMAIN }}'});
        ga('send', 'pageview');

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', '{{ GOOGLE_ANALYTICS_ACCOUNT }}']);
        _gaq.push(['_setDomainName', '{{ GOOGLE_ANALYTICS_DOMAIN }}']);
        _gaq.push(['_setSiteSpeedSampleRate', 10]);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>
<body class="{% if request.user.is_authenticated %}authenticated {% endif %}{% block body-classes %}{% endblock %}">

    {% comment %}
    <div class="contest-bar">
        <div class="container">
            <div class="row">
                <div class="col-xs-10">
                    <p><a href="{% url 'contest-stylesearch' %}">{% trans "Fashion week style search" %} <span class="short">{% trans "Compete with Elin Kling to win €500" %}</span><span class="long">{% trans "Create your fall look and compete with Elin Kling to win €500" %}</span></a></p>
                </div>
                <div class="col-xs-2">
                    <a target="_blank" class="btn btn-primary btn-sm pull-right" href="https://www.facebook.com/photo.php?fbid=649353078422601&set=a.471258842898693.113476.452127981478446&type=1&theater">{% trans "WINNER" %}</a>
                </div>
            </div>
        </div>
    </div>
    {% endcomment %}

    <nav class="navbar navbar-fixed-top navbar-inverse" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <!-- .navbar-toggle is used as the toggle for collapsed navbar content -->
                <button type="button" class="navbar-toggle navbar-left" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                    <span class="sr-only">{% trans "Toggle navigation" %}</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="{% multi_gender_url request 'feed' 'index' %}">
                    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Apprl">
                </a>
            </div>

            <div class="navbar-collapse collapse navbar-responsive-collapse">
                {% block custom_navigation %}{% endblock %}

                <form action="{% multi_gender_url request 'shop' 'search' %}" class="navbar-form navbar-right" autocomplete="off" id="search">
                    <div class="form-group">
                        <input type="text" name="q" class="form-control input-sm" placeholder="{% trans "Search for products, members & brands" %}">
                    </div>
                </form>

                <ul class="nav navbar-nav navbar-nav-login navbar-right">
                    {% if not request.user.is_authenticated %}
                    <li class="visible-xs"><a href="{% url 'auth_register' %}"><span>{% trans "Get started" %}</span></a></li>
                    <li><a href="{% url 'auth_login' %}"><span>{% trans "Log in" %}</span></a></li>
                    {% else %}
                    <li class="dropdown {% selected_url request "/profile/settings" "/profile/"|add:request.user.slug %}">
                       <a class="dropdown-toggle dropdown-avatar" data-toggle="dropdown" href="{{ request.user.url_likes }}"><img class="img-circle" src="{{ request.user.avatar_small }}"><span> {{ request.user.display_name }}</span> <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="{{ request.user.url_likes }}">{% trans "Your profile" %}</a></li>
                            {% if request.user.is_partner %}
                            <li><a href="{% url 'dashboard' %}">{% trans "Your statistics" %}</a></li>
                            {% endif %}
                            {% if request.user.advertiser_store %}
                            <li><a href="{% url 'advertiser-store-admin' %}">{% trans "Your store" %}</a></li>
                            {% endif %}
                            <li><a class="facebook-invite" href="#invite">{% trans "+ Invite friends" %}</a></li>
                            <li><a href="{% url 'look-create' %}">{% trans "+ Create look" %}</a>
                            <li><a href="{% url 'settings-notification' %}">{% trans "Settings" %}</a></li>
                            <li><a href="{% url 'auth_logout' %}">{% trans "Log out" %}</a></li>
                        </ul>
                    </li>
                    {% endif %}
                </ul>

                <ul class="nav navbar-nav navbar-nav-main">
                    {% if request.user.is_authenticated %}
                    <li class="visible-xs"><a href="{% multi_gender_url request 'feed' 'index' %}"><span>{% trans "Your APPRL" %}</span></a></li>
                    {% endif %}
                    <li class="{% selected_url request "/shop" "/products" %}"><a href="{% multi_gender_url request 'shop' 'shop' %}"><span>{% trans "Shop" %}</span></a></li>
                    <li class="{% selected_url request "/looks" %}"><a href="{% multi_gender_url request 'look' 'look-list' %}"><span>{% trans "Looks" %}</span></a></li>
                    <li class="dropdown {% selected_url request "/brands" "/users" %}">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="{% multi_gender_url request 'user' 'user-list' %}"><span>{% trans "Follow" %} <b class="caret"></b></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="{% multi_gender_url request 'user' 'user-list' %}">{% trans "Members" %}</a></li>
                            <li><a href="{% multi_gender_url request 'user' 'brand-list' %}">{% trans "Brands" %}</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    {% comment %} Disabled for now
    {% if not user.is_authenticated %}
    {% login_bar request.path %}
    {% endif %}
    {% endcomment %}

    <div id="content-container">
        {% block full-body %}
        <div class="container">
            {% block body-header %}{% endblock %}
            {% block body %}{% endblock %}
        </div>
        {% endblock %}
    </div>

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <div class="row">
                        <ul class="list-unstyled col-xs-6">
                            <li><h4>{% trans "Shop" %}</h4></li>
                            <li><a class="women" href="{% gender_url 'W' 'shop' %}">{% trans "Women" %}</a></li>
                            <li><a class="men" href="{% gender_url 'M' 'shop' %}">{% trans "Men" %}</a></li>
                            <li><a href="{% multi_gender_url request 'look' 'look-list' %}">{% trans "Looks" %}</a></li>
                            <li><a href="{% multi_gender_url request 'user' 'brand-list' %}">{% trans "Brands" %}</a></li>
                        </ul>
                        <ul class="list-unstyled col-xs-6">
                            <li><h4>{% trans "Language" %}</h4></li>
                            <li class="dropdown">
                                <a class="dropdown-toggle" data-toggle="dropdown" href="{% url 'django.views.i18n.set_language' %}"><span>{% get_language_text LANGUAGE_CODE %} <b class="caret"></b></span></a>
                                <ul id="language-dropdown" class="dropdown-menu">
                                    {% for language in LANGUAGES_DISPLAY %}
                                    <li><a data-language="{{ language.0 }}" href="#">{% trans language.1 %}</a></li>
                                    {% endfor %}
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="row">
                        <ul class="list-unstyled col-xs-6">
                            <li><h4>{% trans "Follow us" %}</h4></li>
                            <li><a target="_blank" href="http://www.facebook.com/apprl">{% trans "Facebook" %}</a></li>
                            <li><a target="_blank" href="http://pinterest.com/apprl/">{% trans "Pinterest" %}</a></li>
                            <li><a target="_blank" href="{% url 'newsletter-redirect' %}">{% trans "E-mail newsletter" %}</a></li>
                        </ul>
                        <ul class="list-unstyled col-xs-6">
                            <li><h4>{% trans "Apprl" %}</h4></li>
                            <li><a target="_blank" href="mailto:info@apprl.com">{% trans "Contact" %}</a></li>
                            <li><a href="{% url 'django.contrib.flatpages.views.flatpage' url='about/terms-of-use/' %}">{% trans "Privacy & Terms" %}</a></li>
                            <li><a href="{% url 'django.contrib.flatpages.views.flatpage' url='about/cookies/' %}">{% trans "Cookies" %}</a></li>
                            <li><a href="{% url 'index-publisher' %}">{% trans "Bloggers" %}</a></li>
                            <li><a href="{% url 'index-store' %}">{% trans "Stores" %}</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="row">
                        <ul class="list-unstyled col-xs-6">
                            <li><h4>Apprl Fashion AB</h4></li>
                            <li>
                                <address>
                                    Sigtunagatan 6<br>
                                    113 22 Stockholm<br>
                                    {% trans "Sweden" %}
                                </address>
                            </li>
                        </ul>
                        <div class="footer-social col-xs-6">
                            <div class="fb-like" data-href="https://facebook.com/apprl/" data-layout="button_count" data-send="false" data-width="100" data-show-faces="false"></div>
                            <div class="last">
                                <a data-pin-do="buttonFollow" href="http://pinterest.com/apprl/">APPRL</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <form action="{% url 'apparelrow.apparel.views.apparel_set_language' %}" method="post" id="languageform">
        {% csrf_token %}
        <select name="language">
            {% for language in LANGUAGES_DISPLAY %}
            <option value="{{ language.0 }}">{% trans language.1 %}</option>
            {% endfor %}
        </select>
    </form>

    {% include 'apparel/fragments/dialog_like_product.html' with request=request csrf_token=csrf_token next=next only %}
    {% include 'apparel/fragments/dialog_like_look.html' with request=request csrf_token=csrf_token next=next only %}
    {% include 'apparel/fragments/dialog_create_look.html' with request=request csrf_token=csrf_token next=next only %}
    {% include 'apparel/fragments/dialog_follow_user.html' with request=request csrf_token=csrf_token next=next only %}
    {% include 'apparel/fragments/dialog_become_member.html' with request=request csrf_token=csrf_token next=next only %}
    {% if request.user.is_authenticated %}
    {% include 'profile/dialog_embed_shop.html' with request=request LANGUAGES=LANGUAGES only %}
    <div class="modal fade" id="modal_embed_look" tabindex="-1"></div>
    <script type="text/html" id="user_like_template">
        <li data-user-id="{{ request.user.pk }}"><a href="{{ request.user.get_absolute_url }}" title="{{ request.user.display_name }}"><img class="img-circle" alt="{{ request.user.display_name }}" title="{{ request.user.display_name }}" src="{{ request.user.avatar }}"></a></li>
    </script>
    {% endif %}

<script type="text/javascript" src="{% static "js/money.min.js" %}"></script>
<script type="text/javascript">
  fx.base = 'SEK';
  fx.rates = {
    {% for currency, rate in currency_rates.items %}
    '{{ currency }}': {{ rate|unlocalize }},
    {% endfor %}
    'SEK': 1
  };
  var current_currency = '{{ CURRENCY }}';
  function formatNumber(num) {
    var array = parseInt(num, 10).toFixed().split('');
    var index = -3;
    while (array.length + index > 0) {
      array.splice(index, 0, ' ');
      index -= 4;
    }
    return array.join('');
  };
  function currencyConversion(elements) {
    elements.each(function(index, element) {
      var $element = jQuery(element);
      var data = $element.data();
      var converted_price = Math.round(fx.convert(data.price, {from: data.currency, to: current_currency}));
      $element.text(formatNumber(converted_price) + ' ' + current_currency);
  });
}
</script>

<div id="fb-root"></div>
<script type="text/javascript">
  (function(d){
     var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement('script'); js.id = id; js.async = true;
     js.src = "//connect.facebook.net/sv_SE/all.js";
     ref.parentNode.insertBefore(js, ref);
   }(document));
</script>

{% include 'mouseflow.html' only %}

{% block body-scripts %}{% endblock body-scripts %}

{% block pinterest-scripts %}
<script type="text/javascript" src="//assets.pinterest.com/js/pinit.js"></script>
{% endblock %}

</body>
</html>
