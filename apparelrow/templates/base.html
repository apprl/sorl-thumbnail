{% load i18n l10n apparel_extras compressed login_bar %}
{% load static from staticfiles %}
<!DOCTYPE html>
<html lang="{{ request.LANGUAGE_CODE }}">
<head{% block head-data %}{% endblock head-data %}>
    <title>{% block full-title %}{% block extra-title %}{% endblock %}Apprl - Social Shopping{% endblock %}</title>
    <meta charset="utf-8" />
    <meta name="description" content="{% spaceless %}{% block meta_description %}{% endblock %}{% endspaceless %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<link rel="stylesheet" href="{% static "styles/screen.css" %}" type="text/css" media="screen, projection">-->
    <!--<link rel="stylesheet" href="{% static "styles/print.css" %}" type="text/css" media="print">-->
    <link rel="shortcut icon" href="{% static "images/favicon.ico" %}">
    <link href='http://fonts.googleapis.com/css?family=Lato:400|IM+Fell+Great+Primer:400italic' rel='stylesheet' type='text/css'>
    {% compressed_css 'bootstrap' %}
    {% block extra-styles %}
    {% endblock extra-styles %}
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript">
        var hasLiked = {% if user.is_authenticated and user.has_liked %}true{% else %}false{% endif %};
        var dialog_like_product = '{% url "dialog-like-product" %}';
        var dialog_like_look = '{% url "dialog-like-look" %}';
        var product_popup_url = '{% url "product-popup" %}';
        var browse_url = '{% gender_url APPAREL_GENDER 'shop' %}';
        var isAuthenticated = {% if user.is_authenticated %}true{% else %}false{% endif %};
        var share_settings = {
            'like_product': {% if user.is_authenticated and user.fb_share_like_product %}true{% else %}false{% endif %},
            'like_look': {% if user.is_authenticated and user.fb_share_like_look %}true{% else %}false{% endif %},
            'follow_profile': {% if user.is_authenticated and user.fb_share_follow_profile %}true{% else %}false{% endif %},
            'create_look': {% if user.is_authenticated and user.fb_share_create_look %}true{% else %}false{% endif %}
        };
        var selected_gender = '{{ APPAREL_GENDER }}';
        var facebook_scope = '{{ FACEBOOK_SCOPE }}';

        window.fbAsyncInit = function() {
            FB.init({appId: {{ FACEBOOK_APP_ID }}, status: true, cookie: true, xfbml: true, channelUrl: '//{{ CURRENT_DOMAIN }}/channel.html'});
            FB.getLoginStatus(function(response) {
                if(!response.authResponse) {
                    jQuery('#ar-facepile').html('').addClass('ar-facepile');
                } else {
                    {% block facebook_code %}{% endblock %}
                }
            });
        }
    </script>
    <script type="text/javascript" src="{% url 'django.views.i18n.javascript_catalog' %}"></script>
    {% compressed_js 'bootstrap' %}
    {% compressed_js 'jquery' %}
    {% compressed_js 'apparel' %}
    <script type="text/javascript">
        window.login_function = function(callback) {
            FB.login(function(response) {
                if(response.authResponse) {
                    data = {uid: response.authResponse.userID, access_token: response.authResponse.accessToken};
                    $.post('/facebook/login', data, function(response) {
                        if(response) {
                            callback(response.next);
                        }
                    });
                }
            }, {scope: facebook_scope});
        };

        function facebookConnect(form){
            function handleResponse(response){
                if (response.authResponse) {
                    jQuery('input[name="access_token"]', form).val(response.authResponse.accessToken);
                    jQuery('input[name="uid"]', form).val(response.authResponse.userID);
                    form.submit();
                }
            }
            FB.login(handleResponse, {scope: '{{ FACEBOOK_SCOPE }}'});
        };

        $(document).ready(function() {
            $('#language-dropdown li').on('click', function() {
                $('#languageform select').val($('a', this).data('language'));
                $('#languageform').submit();
                return false;
            });
            {% if not request.user.is_authenticated and not request.path|slice:"10" == '/accounts/' and not request.path|slice:"9" == '/partner/' %}
            var $stickyLoginBar = $('#sticky-login-bar');
            var panel = $('#panel');
            var panel_offset_bottom = 0;
            if(panel.length > 0) {
                panel_offset_bottom = panel.offset().top + panel.outerHeight();
            }
            var sticky_offset_top = $stickyLoginBar.offset().top;


            jQuery('.ar_welcome').click(function() {
                jQuery('#panel').slideToggle('slow');
                $(this).toggleClass("active");
                var date = new Date();
                date.setTime(date.getTime()+(10000*24*60*60*1000));
                document.cookie = "ar_welcome=1; expires="+date.toUTCString()+"; path=/";
                panel_offset_bottom = 0;
                sticky_offset_top = panel.offset().top;
                $stickyLoginBar.fadeIn(200);
            });

            var sticky_calculate = function() {
                var scroll_top = $(window).scrollTop();
                if(scroll_top > sticky_offset_top) {
                    $('#sticky-login-placeholder').height($stickyLoginBar.outerHeight()).show();
                    $stickyLoginBar.css({position: 'fixed', top: 0, left: 0});
                } else {
                    $('#sticky-login-placeholder').hide();
                    $stickyLoginBar.css({position: 'relative'});
                }

                {% if request.path == '/' or request.path == '/all/men/' or request.path == '/all/women/' %}
                if(panel_offset_bottom > 0) {
                    if(scroll_top > panel_offset_bottom) {
                        $stickyLoginBar.fadeIn(200);
                    } else {
                        $stickyLoginBar.fadeOut(200);
                    }
                }
                {% endif %}
            };
            sticky_calculate();
            $(window).scroll(function() {
                 sticky_calculate();
            });
            {% endif %}
        });
    </script>
    {% block 'extra-scripts' %}
    {% endblock 'extra-scripts' %}
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', '{{ GOOGLE_ANALYTICS_ACCOUNT }}']);
        _gaq.push(['_setDomainName', '{{ GOOGLE_ANALYTICS_DOMAIN }}']);
        _gaq.push(['_setSiteSpeedSampleRate', 10]);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>
<body class="{% if request.user.is_authenticated %}authenticated {% endif %}{% block body-classes %}{% endblock %}">

    <div class="navbar navbar-fixed-top navbar-inverse">
        <div class="container">

            <!-- .navbar-toggle is used as the toggle for collapsed navbar content -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Be sure to leave the brand out there if you want it shown -->
            <a class="navbar-brand" href="{% if request.user.is_authenticated %}{% url 'user_feed' %}{% else %}{% url 'public_feed' %}{% endif %}">
                <img src="{% static "images/logo.png" %}" alt="Apprl">
            </a>

            <!-- Place everything within .navbar-collapse to hide it until above 768px -->
            <div class="nav-collapse collapse navbar-responsive-collapse">
                <ul class="nav navbar-nav">
                    <li class="{% selected_url request "/" "/all" %}"><a href="{% if request.user.is_authenticated %}{% url 'user_feed' %}{% else %}{% url 'public_feed' %}{% endif %}">{% trans "Newsfeed" %}</a></li>
                    <li class="{% selected_url request "/shop" "/products" %}"><a href="{% gender_url APPAREL_GENDER 'shop' %}">{% trans "Shop" %}</a></li>
                    <li class="{% selected_url request "/looks" %}"><a href="{% gender_url APPAREL_GENDER 'look-list' %}">{% trans "Looks" %}</a></li>
                    <li class="dropdown {% selected_url request "/users" "/brand" "/profile" %}">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">{% trans "Looks" %} <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="{% url 'user-list-popular' %}">{% trans "Members" %}</a></li>
                            <li><a href="{% gender_url APPAREL_GENDER 'brand-list' %}">{% trans "Brands" %}</a></li>
                        </ul>
                    </li>
                </ul>

                <ul class="nav navbar-nav pull-right">
                    {% if not request.user.is_authenticated %}
                    <li><a href="{% url 'auth_login' %}">{% trans "Log in" %}</a></li>
                    {% else %}
                    <li class="dropdown {% selected_url request "/profile/settings" "/profile/"|add:request.user.slug %}">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">{{ request.user.display_name }} <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="{{ request.user.url_likes }}">{% trans "Your profile" %}</a></li>
                            {% if request.user.is_partner %}
                            <li><a href="{% url 'dashboard' %}">{% trans "Your statistics" %}</a></li>
                            {% endif %}
                            {% if request.user.advertiser_store %}
                            <li><a href="{% url 'advertiser-store-admin' %}">{% trans "Your store" %}</a></li>
                            {% endif %}
                            <li><a class="facebook-invite" href="#invite">{% trans "+ Invite friends" %}</a></li>
                            <li><a href="{% url 'look-create' %}">{% trans "+ Create look" %}</a>
                            <li><a href="{% url 'settings-notification' %}">{% trans "Settings" %}</a></li>
                            <li><a href="{% url 'auth_logout' %}">{% trans "Log out" %}</a></li>
                        </ul>
                    </li>
                    {% endif %}
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="{% url 'django.views.i18n.set_language' %}">{% get_language_text LANGUAGE_CODE %} <b class="caret"></b></a>
                        <ul id="language-dropdown" class="dropdown-menu">
                            {% for language in LANGUAGES_DISPLAY %}
                            <li><a data-language="{{ language.0 }}" href="#">{% trans language.1 %}</a></li>
                            {% endfor %}
                        </ul>
                    </li>
                    <li><a href="#"> test <span class="glyphicon glyphicon-search"></span></a></li>
                </ul>
            </div>
        </div>
    </div>

    {% if not user.is_authenticated %}
    {% login_bar request.path %}
    {% endif %}



        <!--<div id="search-result">-->
            <!--<div id="inner-search-result">-->
                <!--<div class="wide result-container">-->
                    <!--<h2 class="search-result-products">{% trans "Matching products" %}</h2>-->
                    <!--<div class="product-list"><ul id="search-result-products" class="list"></ul></div>-->
                    <!--<div class="search-link"><a class="search-result-products btn btn-block btn-upper" href="#" style="display:none;">{% trans "Show all products" %}</a></div>-->
                    <!--</div>-->
                <!--<div class="result-container">-->
                    <!--<h2 class="search-result-looks">{% trans "Matching looks" %}</h2>-->
                    <!--<ul id="search-result-looks" class="looks"></ul>-->
                    <!--<div class="search-link"><a class="search-result-looks btn btn-block btn-upper" href="#" style="display:none;">{% trans "Show all looks" %}</a></div>-->
                    <!--</div>-->
                <!--<div class="last result-container">-->
                    <!--<h2 class="search-result-manufacturers">{% trans "Matching brands" %}</h2>-->
                    <!--<ul id="search-result-manufacturers"></ul>-->
                    <!--<div class="search-link"><a class="search-result-manufacturers btn btn-block btn-upper" href="#" style="display:none;">{% trans "Show all manufacturers" %}</a></div>-->

                    <!--<h2 class="search-result-stores">{% trans "Matching stores" %}</h2>-->
                    <!--<ul id="search-result-stores"></ul>-->

                    <!--<h2 class="search-result-profiles">{% trans "Matching members" %}</h2>-->
                    <!--<ul id="search-result-profiles"></ul>-->
                    <!--</div>-->
                <!--<div id="search-result-clear" class="clear"></div>-->
                <!--</div>-->
            <!--</div>-->

    <div id="container" class="container">
        {% block body-header %}{% endblock %}
        {% block body %}{% endblock %}
    </div>

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-4">
                    <div class="row">
                        <ul class="list-unstyled col-6">
                            <li><h4>{% trans "Shop" %}</h4></li>
                            <li><a class="women" href="{% gender_url 'W' 'shop' %}">{% trans "Women" %}</a></li>
                            <li><a class="men" href="{% gender_url 'M' 'shop' %}">{% trans "Men" %}</a></li>
                            <li><a href="{% gender_url APPAREL_GENDER 'look-list' %}">{% trans "Looks" %}</a></li>
                            <li><a href="{% gender_url APPAREL_GENDER 'brand-list' %}">{% trans "Brands" %}</a></li>
                        </ul>
                        <ul class="list-unstyled col-6">
                            <li><h4>{% trans "Join" %}</h4></li>
                            {% if not request.user.is_authenticated %}
                            <li><a href="{% url 'auth_register' %}">{% trans "Sign up" %}</a></li>
                            {% endif %}
                            <li><a href="{% url 'dashboard' %}">{% trans "Bloggers" %}</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="row">
                        <ul class="list-unstyled col-6">
                            <li><h4>{% trans "Follow us" %}</h4></li>
                            <li><a target="_blank" href="http://www.facebook.com/apprl">{% trans "Facebook" %}</a></li>
                            <li><a target="_blank" href="http://pinterest.com/apprl/">{% trans "Pinterest" %}</a></li>
                            <li><a target="_blank" href="{% url 'newsletter-redirect' %}">{% trans "E-mail newsletter" %}</a></li>
                        </ul>
                        <ul class="list-unstyled col-6">
                            <li><h4>{% trans "Apprl" %}</h4></li>
                            <li><a href="mailto:info@apprl.com">{% trans "Contact" %}</a></li>
                            <li><a href="{% url 'django.contrib.flatpages.views.flatpage' url='about/terms-of-use/' %}">{% trans "Privacy & Terms" %}</a></li>
                            <li><a href="{% url 'django.contrib.flatpages.views.flatpage' url='about/cookies/' %}">{% trans "Cookies" %}</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="row">
                        <ul class="list-unstyled col-sm-6 copyright">
                            <li><h4>Apprl Fashion AB</h4></li>
                            <li>Sigtunagatan 6</li>
                            <li>113 22 Stockholm</li>
                            <li>{% trans "Sweden" %}</li>
                        </ul>
                        <div class="footer-social col-sm-6">
                            <div class="fb-like" data-href="https://facebook.com/apprl/" data-layout="button_count" data-send="false" data-width="100" data-show-faces="false"></div>
                            <div class="last">
                                <a data-pin-do="buttonFollow" href="http://pinterest.com/apprl/">APPRL</a>
                            </div>
                            {% if not request.user.is_partner %}
                            <a href="{% url 'dashboard' %}" class="btn btn-default">{% trans "Become a partner blogger" %}</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <a id="feedback" href="mailto:feedback@apprl.com?subject={% trans "Hi Apprl! I have a question / idea / complaint / complement" %}"><img src="{% static "images/feedback-button.png" %}"></a>

    <form action="{% url 'apparelrow.apparel.views.apparel_set_language' %}" method="post" id="languageform">
        {% csrf_token %}
        <select name="language">
            {% for language in LANGUAGES_DISPLAY %}
            <option value="{{ language.0 }}">{% trans language.1 %}</option>
            {% endfor %}
        </select>
    </form>

<script type="text/javascript" src="{% static "js/money.min.js" %}"></script>
<script type="text/javascript">
  fx.base = 'SEK';
  fx.rates = {
    {% for currency, rate in currency_rates.items %}
    '{{ currency }}': {{ rate|unlocalize }},
    {% endfor %}
    'SEK': 1
  };
  var current_currency = '{{ CURRENCY }}';
  function formatNumber(num) {
    var array = parseInt(num, 10).toFixed().split('');
    var index = -3;
    while (array.length + index > 0) {
      array.splice(index, 0, ' ');
      index -= 4;
    }
    return array.join('');
  };
  function currencyConversion(elements) {
    elements.each(function(index, element) {
      var $element = jQuery(element);
      var data = $element.data();
      var converted_price = Math.round(fx.convert(data.price, {from: data.currency, to: current_currency}));
      $element.text(formatNumber(converted_price) + ' ' + current_currency);
  });
}
</script>

<div id="fb-root"></div>
<script type="text/javascript">
  (function(d){
     var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement('script'); js.id = id; js.async = true;
     js.src = "//connect.facebook.net/sv_SE/all.js";
     ref.parentNode.insertBefore(js, ref);
   }(document));
</script>

{% for template_name,template_string in templates.items %}
    <script type="text/html" id="{{ template_name }}_template">
        {{ template_string|safe }}
    </script>
{% endfor %}

<script type="text/html" id="error_dialog_template">
    <div class="dialog-container {% block dialog_class %}{% endblock %}">
        <h1><%= header %></h1>
        <div class="bodycopy content">
            <% _.each(messages, function(message) { %><p><%= message %></p><% }); %>
        </div>
        <div class="dialog-footer">
            <button class="no">{% trans "No" %}</button>
            <button class="yes">{% trans "Yes" %}</button>
        </div>
    </div>
</script>

{% include 'mouseflow.html' only %}

{% block body-scripts %}{% endblock body-scripts %}

{% block pinterest-scripts %}
<script type="text/javascript" src="//assets.pinterest.com/js/pinit.js"></script>
{% endblock %}

</body>
</html>
