{% load i18n %}
{% load facebook %}
{% load apparel_extras %}
<!doctype html>
<html lang="{{ lang }}">
<head>
    <title>{% block extra-title %}{% endblock %}Apparel Row</title>
    <meta charset="utf-8" />
    <link type="text/css" href="{{ MEDIA_URL }}styles/smoothness/jquery-ui-1.8rc3.custom.css" rel="stylesheet" />
    <link rel="stylesheet" href="{{ MEDIA_URL }}styles/screen.css" type="text/css" media="screen, projection">
    <link rel="stylesheet" href="{{ MEDIA_URL }}styles/print.css" type="text/css" media="print">
    {% block 'extra-styles' %}
    {% endblock 'extra-styles' %}
    
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">
        google.load("jquery", "1.4.2");
        google.load("jqueryui", "1.8.0");
        
        var isAuthenticated = {% if user.is_authenticated %}true{% else %}false{% endif %};
    </script>
    <script type="text/javascript" src="{% url django.views.i18n.javascript_catalog %}"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/compiled/jquery.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/apparel.js"></script>
    <script type="text/javascript">
        
        jQuery(document).ready(function() {
             function toggleLoginDialog() {
                jQuery('#nav-main').animate({ opacity: 'toggle' }, 'fast');
                jQuery('#account-dialogue').animate({ opacity: 'toggle' }, 'fast');
                
                return false;
            };

            jQuery('#login').click(toggleLoginDialog);
            jQuery('#account-dialogue .cancel').click(toggleLoginDialog);
            
            /* Toggle text field texts */
            jQuery('#account-dialogue input[type=text]').each(function() {
                if(this.name) {
                    jQuery(this).focus(function() { 
                        this.value = '';
                        jQuery(this).removeClass('default-value');
                    } );
                    
                    jQuery(this).blur(function() { 
                        if(this.value == '') {
                            this.value = this.defaultValue 
                            jQuery(this).addClass('default-value');
                        }
                    } );
                }
            });
            
            /* Toggle password box */
            jQuery('#login-password-placeholder').focus(function() {
                pwdField = jQuery('#login-password');
                jQuery(this).toggle();
                pwdField.toggle();
                pwdField.focus();
            });
            
            jQuery('#login-password').blur(function() {
                if(this.value == '') {
                    txtField = jQuery('#login-password-placeholder');
                    jQuery(this).toggle();
                    txtField.toggle();
                }
            });            

            jQuery('#about-beta').click(function(event) {
                jQuery('#error_dialog_template')
                    .render({
                        header: "{% trans "About ApparelRow beta" %}",
                        messages: [
                            "{% trans "Hi beta tester!" %}",
                            "{% trans "Right now, this site is only available to a few select individuals, who we believe can help make it better together with us. We appreciate all questions, suggestions, praise and problems we can get from you, the more the better! Just click on the 'Feedback' link to the right and share your thoughts." %}",
                            "{% trans "What's more, we're not sure we've found the right name for the site yet and we'd love your suggestion! If you have ideas for what to call the site, just click the button next to our logo and type in your suggestion. A top secret prize will be awarded to whoever suggests the name we eventually choose." %}",
                            "{% trans "Feel free to e-mail us at info@apparelrow.com." %}",
                            "{% trans "Have fun! /The team" %}"
                        ]
                    })
                    .appendTo('body')
                    .overlay({
                        mask: {
                            color: '#000',
                            loadSpeed: 200,
                            opacity: 0.5
                        },
                        load: true,
                        closeOnClick: false,
                        close: '.ok',
                        top: 100,
                        onClose: function(e) { this.getTrigger().remove() }
                    })
                ;
                event.preventDefault();
            });
        });
    
    </script>
    {% facebook_init %}
        {% block facebook_code %}
        // Reload page on Facebook login
        FB.Event.subscribe('auth.login', function() { location.reload() });
        {% endblock %}
    {% endfacebook %}
    {% block 'extra-scripts' %}
    {% endblock 'extra-scripts' %}
</head>
<body class="{% block body-classes %}{% endblock %}">

<div id="header">
    <div class="container">
        
        <a href="/"><h1 class="beta">ApparelRow</h1></a>
        
        <div id="account-dialogue">
            <!-- LOGIN FORM -->
            <form action="/accounts/login/" method="post" id="login-form">
                {% csrf_token %}
                <!--
                <a id="login-forgot-password" href="/accounts/password/reset/">{% trans "Forgot password?" %}</a>
                <a id="login-create-account" href="/accounts/register/">{% trans "Create account" %}</a>
                -->
                <div>
                    <input type="text" name="username" class="default-value" value="{% trans "Username" %}" id="login-username" />
                    <input type="text" value="{% trans "Password" %}" class="default-value" id="login-password-placeholder" />
                    <input type="password" name="password" id="login-password" />
                    <button type="submit" name="submit" id="login-submit">{% trans "Login" %}</button>
                    {% ifequal request.path "/accounts/logout/" %}
                        <input type="hidden" name="next" value="/" />
                    {% else %}
                        <input type="hidden" name="next" value="{{ request.get_full_path }}" />
                    {% endifequal %}
                </div>
            </form>
            <div id="login-more">
                <a href="{% url registration_register %}">{% trans "Create account" %}</a> | <a href="{% url auth_password_reset %}">{% trans "Forgot password" %}</a> | <fb:login-button show-faces="false" width="18" max-rows="1" size="small" perms="{% facebook_perms %}"></fb:login-button> | <a href="{{ request.url }}" class="cancel">{% trans "Cancel" %}</a>
            </div>
        </div>
        <form action="/apparel/search" method="get" onsubmit="return false" id="search">
            <input type="text" name="s" placeholder="{% trans 'Search for products' %}" />
            <div id="search-result">
                <a href="{{ request.url }}" id="cancel-search">{% trans "Cancel" %}</a>
                <div class="wide result-container">
                    <h2>{% trans "Matching products" %}</h2>
                    <div class="product-list"><ul id="search-result-products"></ul></div>
                </div>
                <div class="result-container">
                    <h2>{% trans "Matching looks" %}</h2>
                    <ul id="search-result-looks" class="looks"></ul>
                </div>
                <div class="last result-container">
                    <h2>{% trans "Matching brands" %}</h2>
                    <ul id="search-result-manufacturers"></ul>
                </div>
            </div>
        </form>
        
        <ul id="nav-main">
            <li><a href="{% url apparel.views.browse %}?1:p.gender=W">{% trans "Women" %}</a></li>
            <li><a href="{% url apparel.views.browse %}?1:p.gender=M">{% trans "Men" %}</a></li>
            <li><a href="http://blog.apparelrow.com/">{% trans "Blog" %}</a></li>
            <li><a id="about-beta" href="{% url beta.views.about %}">{% trans "About the beta" %}</a></li>
        {% if not user.is_authenticated %}
            <li><a href="{% url auth_login %}" id="login">{% trans "Login" %}</a></li>
            <li><a href="{% url registration_register %}" id="login">{% trans "Sign up" %}</a></li>
            <li>
            {# Facebook connect button #}
            <fb:login-button show-faces="false" width="18" max-rows="1" size="small" perms="{% facebook_perms %}"></fb:login-button>
            </li>
        {% endif %}
            <li>{% include 'apparel/fragments/set_language.html' %}</li>
        </ul>
    </div>
</div>


<div id="container">
    <div class="container">
{% if user.is_authenticated and user.get_profile %}
    {% url apparel.views.home as home_url %}
    {% url profile.views.profile as profile_url %}
    {% url apparel.views.look_create as look_create_url %}
    
<div id="login-pane">
    <div class="left">
        {% trans "Logged in as" %} <a href="{{ home_url }}">{{ user.get_profile.display_name }}</a>
    </div>
    <ul>
        <li>
            <a class="first{% ifequal request.path home_url %} selected{% endifequal %}" href="{{ home_url }}">
                {% trans "Overview" %}
                <div class="arrow"></div>
            </a>
        </li>
        <li>
            <a class="{% ifequal request.path profile_url %} selected{% endifequal %}" href="{{ profile_url }}">
                {% trans "My profile" %}
                <div class="arrow"></div>
            </a>
        </li>
        <li>
            <a class="last{% ifequal request.path look_create_url %} selected{% endifequal %}" href="{{ look_create_url }}">
                {% trans "Create a look" %}
                <div class="arrow"></div>
            </a>
        </li>
    </ul>
    <div class="right">
        <a href="/accounts/logout/" id="logout">{% trans "Logout" %}</a>
    </div>
</div>
{% endif %}
    {% block body %}{% endblock %}
    </div>
</div>
<div id="footer">
    <div class="container">
    </div>
</div>

{% for template_name,template_string in templates.items %}
    <script type="text/html" id="{{ template_name }}_template">
        {{ template_string|safe }}
    </script>
{% endfor %}

    <script type="text/html" id="error_dialog_template">
        <div class="dialog error">
            <h2>${ header }</h2>
            {% templatetag openvariable %}each(i, message) messages{% templatetag closevariable %}
                <p>${ message }</p>
            {% templatetag openvariable %}/each{% templatetag closevariable %}
            <div class="buttons"><button class="ok">{% trans "OK" %}</button></div>
        </div>
    </script>

    <script type="text/html" id="manufacturer_search_template">
        <a href="/browse/?1:m.id:in=${ object.id}" id="manufacturer-${ object.id }">${ object.name }</a>
    </script>

    <script type="text/html" id="product_template">
        <li id="product-${ product.id }">
<a href="${ product.get_absolute_url }">
<div class="product-small">
    <div class="product-image">
        <img src="/scale/115x153${ product.product_image.url }" alt="${ product.product_name }" />
        <span class="likes">x</span>
    </div>
    <h4>${ product.product_name }</h4>
    <span class="price">${ product.default_vendor.price } ${ product.default_vendor.currency }</span>
</div>
</a>
</li>

    </script>
    {% facebook_load %}

<script type="text/javascript">
    var _kundo = _kundo || {};
    _kundo["org"] = "apparelrow";
    _kundo["lang"] = "{{ request.LANGUAGE_CODE }}";

    (function() {
        function async_load(){
            var s = document.createElement('script');
            s.type = 'text/javascript';
            s.async = true;
            s.src = ('https:' == document.location.protocol ? 'https://static-ssl' : 'http://static') +
            '.kundo.se/embed.js';
            var x = document.getElementsByTagName('script')[0];
            x.parentNode.insertBefore(s, x);
        }
        if (window.attachEvent)
            window.attachEvent('onload', async_load);
        else
            window.addEventListener('load', async_load, false);
    })();
</script>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', '{{ GOOGLE_ANALYTICS_ACCOUNT }}']);
  _gaq.push(['_setDomainName', '{{ GOOGLE_ANALYTICS_DOMAIN }}']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
